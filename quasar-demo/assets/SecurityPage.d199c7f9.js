import{d as J,r as n,b7 as K,b6 as O,a8 as U,o as r,a as m,w as o,Q as W,c0 as Z,c1 as j,c2 as G,c3 as X,c4 as _,c5 as x,c6 as ee,c7 as se,c8 as ae,c9 as oe,e as a,I as p,t as d,J as le,aJ as c,ca as te,ae as k,g as i,H as A,cb as ne,bm as re,y as M,cc as de,v as ie,i as y,f as h,j as $,k as ue,l as me,m as D,B as pe,F as ce}from"./index.1297aae9.js";import{u as we}from"./useLang.596523dd.js";import{u as fe}from"./use-meta.b344b526.js";import{u as ve,A as be}from"./useAuth.c6a9d1a5.js";import{U as ge}from"./UserService.a61d0f3f.js";import{u as ye}from"./useBase.9460d773.js";import{_ as he}from"./plugin-vue_export-helper.21dcd24c.js";import"./useAxios.2557c634.js";const Pe={biLock:Z,biEye:j,biEyeSlash:G,biShieldLock:X,biCheck:_,mdiAndroid:x,mdiApple:ee,biDisplay:se,biDot:ae},Se=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,ke=J({components:{},setup(){fe({title:"Account security"});const{WeeConfirm:e,WeeLoader:l}=ye(),{t:w}=we(),{logoutToServer:V,destroyAuthDataAndRedirect:C}=ve(),{selfUpdatePassword:Q,currentAuthSession:s}=ge(),{removeAccessTokenSession:P}=be(),f=n(""),u=n(""),v=n(""),L=n(!1),q=n(!0),S=n(!1),b=n([]),R=n(!0),g=n(null);K(()=>{Y()}),O(()=>{g.value&&(clearTimeout(g.value),g.value=null)});const z=async()=>{S.value=!0;const t=await Q({userChangePasswordRequest:{password:f.value,newPassword:u.value,logoutAllDevice:q.value}});S.value=!1,t.status=="OK"&&(g.value=setTimeout(()=>{V(),C()},1500))},E=()=>{f.value="",u.value="",v.value="",L.value=!1},T=t=>Se.test(t),I=t=>t===u.value,F=U(()=>T(u.value)),H=U(()=>v.value&&u.value===v.value),Y=async()=>{b.value=await s(),R.value=!1};return{...Pe,onDeleteSession:async t=>{if(await e(w("authSessions"),w("base.deleteConfirm"))){const B=b.value[t];if(B){l();const N=await P(B.id);l(!1),N.status=="OK"&&(console.log("removeAccessTokenSession",N),b.value.splice(t,1))}}},currentPassword:f,rePassword:v,newPassword:u,showPassword:L,onSubmit:z,onReset:E,t:w,loading:S,validatePwdStrong:T,validateTheSamePwd:I,isValidPwd:F,isSamePwd:H,sessionList:b,displayDate:t=>t?oe.formatDate(t,"MMMM DD YYYY, HH:mm:ss"):"-",sessionLoading:R,logoutAllDevice:q}}}),Ae={class:"text-h6"},De={class:"text-h6"},Ve={class:"text-weight-medium"},Ce={class:"text-grey-8"},Qe={key:0},Le={class:"text-grey-8 q-gutter-xs"};function qe(e,l,w,V,C,Q){return r(),m(W,{square:"",flat:"",class:"bg-transparent q-pl-lg"},{default:o(()=>[a(c,null,{default:o(()=>[p("div",Ae,d(e.t("updatePassword")),1),a(le)]),_:1}),a(c,null,{default:o(()=>[a(te,{onSubmit:e.onSubmit,onReset:e.onReset,ref:"loginForm",class:"q-px-sm"},{default:o(()=>[a(c,null,{default:o(()=>[a(k,{readonly:e.loading,outlined:"",dense:"",modelValue:e.currentPassword,"onUpdate:modelValue":l[1]||(l[1]=s=>e.currentPassword=s),type:e.showPassword?"text":"password",label:e.t("authen.currentPassword"),rules:[s=>s&&s.length>0||e.t("error.validateRequire",[e.t("authen.currentPassword")])]},{prepend:o(()=>[a(i,{name:e.biShieldLock},null,8,["name"])]),append:o(()=>[a(i,{name:e.showPassword?e.biEye:e.biEyeSlash,onClick:l[0]||(l[0]=s=>e.showPassword=!e.showPassword)},null,8,["name"])]),_:1},8,["readonly","modelValue","type","label","rules"]),a(k,{class:"q-pt-md",readonly:e.loading,outlined:"",dense:"",modelValue:e.newPassword,"onUpdate:modelValue":l[2]||(l[2]=s=>e.newPassword=s),type:e.showPassword?"text":"password",label:e.t("authen.newPassword"),rules:[s=>s&&s.length>0||e.t("error.validateRequire",[e.t("authen.newPassword")]),s=>e.validatePwdStrong(s)||e.t("error.passwordStrongError")]},{prepend:o(()=>[a(i,{name:e.biLock,color:"grey-9"},null,8,["name"])]),append:o(()=>[e.isValidPwd?(r(),m(i,{key:0,name:e.biCheck,color:"positive"},null,8,["name"])):A("",!0)]),_:1},8,["readonly","modelValue","type","label","rules"]),a(k,{class:"q-pt-md",readonly:e.loading,outlined:"",dense:"",modelValue:e.rePassword,"onUpdate:modelValue":l[3]||(l[3]=s=>e.rePassword=s),type:e.showPassword?"text":"password",label:e.t("authen.confirmPassword"),rules:[s=>s&&s.length>0||e.t("error.validateRequire",[e.t("authen.confirmPassword")]),s=>e.validateTheSamePwd(s)||e.t("error.passwordNotMatchNew")]},{prepend:o(()=>[a(i,{name:e.biLock,color:"grey-9"},null,8,["name"])]),append:o(()=>[e.isSamePwd?(r(),m(i,{key:0,name:e.biCheck,color:"positive"},null,8,["name"])):A("",!0)]),_:1},8,["readonly","modelValue","type","label","rules"])]),_:1}),a(c,null,{default:o(()=>[p("div",null,[a(ne,{modelValue:e.logoutAllDevice,"onUpdate:modelValue":l[4]||(l[4]=s=>e.logoutAllDevice=s),label:e.t("authen.logoutAll")},null,8,["modelValue","label"])])]),_:1}),a(re,null,{default:o(()=>[a(M,{unelevated:"",outline:"",loading:e.loading,label:e.t("updatePassword"),type:"submit"},null,8,["loading","label"])]),_:1})]),_:1},8,["onSubmit","onReset"])]),_:1}),a(c,null,{default:o(()=>[p("div",De,d(e.t("authSessions")),1)]),_:1}),e.sessionLoading?(r(),m(c,{key:0,class:"text-center"},{default:o(()=>[a(de,{color:"primary",size:"3em"})]),_:1})):(r(),m(ie,{key:1,bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[a(h,{header:""},{default:o(()=>[y(d(e.t("authSessionsHelp")),1)]),_:1}),(r(!0),$(ce,null,ue(e.sessionList,(s,P)=>(r(),m(me,{key:s.id},{default:o(()=>[a(D,{avatar:"",top:""},{default:o(()=>[a(i,{name:s.loginPlatform==1?e.biDisplay:s.loginPlatform==2?e.mdiApple:e.mdiAndroid,color:"black",size:"34px"},null,8,["name"])]),_:2},1024),a(D,{top:""},{default:o(()=>[a(h,{lines:"1"},{default:o(()=>[p("span",Ve,"["+d(s.ipAddredd)+"]",1),p("span",Ce," - "+d(s.hostName),1),s.activeNow?(r(),$("span",Qe,[a(i,{size:"lg",name:e.biDot,color:"positive"},null,8,["name"])])):A("",!0)]),_:2},1024),a(h,{lines:"1"},{default:o(()=>[y(d(s.agent),1)]),_:2},1024),a(h,{lines:"1",caption:""},{default:o(()=>[y(d(e.t("lastestActive")+" "+e.displayDate(s.lastestActive||s.createdDate)),1)]),_:2},1024)]),_:2},1024),a(D,{top:"",side:""},{default:o(()=>[p("div",Le,[a(M,{class:"gt-xs",size:"12px",flat:"",round:"",icon:"bi-trash",onClick:f=>e.onDeleteSession(P)},{default:o(()=>[a(pe,null,{default:o(()=>[y(d(e.t("base.delete")),1)]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})}var He=he(ke,[["render",qe]]);export{He as default};
