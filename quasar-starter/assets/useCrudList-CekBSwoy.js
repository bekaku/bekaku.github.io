import{u as de,a as fe,r as l,c as v,o as me,s as Q,K as ge,i as he,d as R,e as Pe,f as pe,g as $e,h as we,S as b,j as Ee,C as D,k as ye}from"./index--rRessbS.js";import{u as Se}from"./useSort-DQmN69Np.js";import{u as Ae}from"./useAxios-BBYX69-N.js";const Ie=(t,T)=>{const{pages:s,sort:u,resetSort:k}=Se(t?t.defaultSort:void 0,t?t.itemsPerPage:10),{t:q}=de(),{appNavigateTo:m,getCurrentPath:_,getQuery:z,appConfirm:F,appLoading:g,inputSanitizeHtml:H}=fe(),{callAxios:U}=Ae(),i=l([]),N=l(!1),C=l(!1),B=l(),o=l(""),d=l(""),h=l(""),P=l(t.additionalUri),p=l(t.actionList),$=l(t.actionDelete),w=l(T!=null?T.value:[]),K=v(()=>{const e=[];return w.value&&w.value.length>0?w.value.filter(a=>a.options&&a.options.searchable===!0):e}),W=e=>K.value.find(a=>a.column===e)!=null,Z=()=>{const a=z(b)?.split(","),r=Ee;if(a&&a.length>0)for(const n of a)for(const f in r)j(n,r[f])},j=(e,a)=>{const r=e.split(a);r.length==2&&W(r[0])&&(o.value?o.value+=","+e.trim():o.value=`${b}=${e.trim()}`)};Z(),me(async()=>{t.fetchListOnload&&await S()});const G=v(()=>p.value?p.value:t.apiEndpoint&&t.crudName?t.apiEndpoint+"/"+Q(t.crudName):""),V=v(()=>$.value?$.value:t.apiEndpoint&&t.crudName?t.apiEndpoint+"/"+Q(t.crudName):""),E=v(()=>{let e=!1,a="";return(t.pageAble==null||t.pageAble)&&(a+=`page=${t.pageStartZero==null||t.pageStartZero?s.value.current>0?s.value.current-1:0:s.value.current}`,a+=`&size=${s.value.itemsPerPage}`,e=!0),(t.sortAble==null||t.sortAble)&&(e&&(a+="&"),a+=`${u.value.column&&u.value.mode?"sort="+u.value.column+","+u.value.mode:""}`,e=!0),o.value&&(e&&(a+="&"),a+=`${o.value}`,e=!0),d.value&&(e&&(a+="&"),a+=`${ge}=${d.value}`,e=!0),P.value&&(e&&(a+="&"),a+=`${P.value}`,e=!0),he(a)?void 0:a}),M=v(()=>`${G.value}${E.value?"?"+E.value:""}`),y=v(()=>{if(t)return`${_(!1)}${E.value?"?"+E.value:""}`}),S=async()=>{if(!M.value)return new Promise(a=>{a(!1)});C.value=!0;const e=await U({API:M.value,method:"GET"});return new Promise(a=>{!R(e)&&!Pe(e)&&(pe(e)?(i.value=e.dataList,e.totalPages!=null&&(s.value.totalPages=e.totalPages),e.totalElements!=null&&(s.value.totalElements=e.totalElements),e.last!=null&&(s.value.last=e.last)):$e(e)&&e!=null&&(i.value=e)),N.value||(N.value=!0),C.value=!1,a(!0)})},I=v(()=>{const e=i.value,a=h.value?h.value.toLowerCase().trim():null;if(!a)return e;let r=[];const n=K.value;if(n.length==0)return e;for(const f of n){const L=f.column;if(L&&e&&e.length>0){const ce=e.filter(x=>x[L]&&x[L].toString().toLowerCase().includes(a)&&!r.find(ve=>ve.id===x.id));r=r.concat(ce)}}return r}),Y=async e=>{s.value.current=e,y.value&&c()},J=async e=>{s.value.itemsPerPage=e,y.value&&c()},X=async e=>{u.value.column===e?u.value.mode=u.value.mode==="asc"?"desc":"asc":u.value.column=e,c()},ee=async e=>{u.value.mode=e,c()},c=async()=>{y.value&&(m(y.value),await S())},ae=e=>{d.value="",o.value=`${b}=${e}`,c()},te=e=>{d.value=H(e),c()},re=()=>{o.value="",s.value.current=1,i.value=[],k(),c()},A=e=>new Promise(a=>{const r=I.value.length>0?I.value[e]:null;a(r)}),ne=e=>new Promise(a=>{a(i.value.findIndex(r=>r.id===e))}),se=async(e,a)=>{if(await F(q("app.monogram"),q("base.deleteConfirm")))if(a){const n=await A(e);if(n){const f=await ne(n.id);g(),await O(n.id)&&f!=-1&&i.value.splice(f,1),g(!1)}}else{g();for(const n of e)await O(n);await S(),g(!1)}},O=async e=>{const a=`${V.value}/${e}`,r=await U({API:a,method:"DELETE"});return R(r)||ye(r)?new Promise(n=>{n(!1)}):new Promise(n=>{n(!!(r&&r.status=="OK"))})},le=()=>{t.apiEndpoint&&t.crudName&&m(`${t.crudName.replaceAll("_","-")}/${D.NEW}/0`)},ue=async e=>{const a=await A(e);a&&t.apiEndpoint&&t.crudName&&m(`${t.crudName.replaceAll("_","-")}/${D.VIEW}/${a.id}`)},ie=async e=>{const a=await A(e);a&&t.apiEndpoint&&t.crudName&&m(`${t.crudName.replaceAll("_","-")}/${D.COPY}/${a.id}`)};we(()=>{i.value=[],o.value="",d.value="",h.value="",B.value=void 0,P.value=void 0,p.value=void 0,$.value=void 0});const oe={onPageNoChange:Y,onItemPerPageChange:J,fetchList:S,onSort:X,onSortMode:ee,onReload:re,filteredList:I,onAdvanceSearch:ae,onKeywordSearch:te,onItemDelete:se,onNewForm:le,onItemClick:ue,onItemCopy:ie,getItemByIndex:A};return{pages:s,sort:u,resetSort:k,loading:C,fristLoad:N,dataList:i,filterText:h,keywordSearchText:d,crudName:t.crudName,manualActionList:B,additionalUri:P,actionList:p,actionDelete:$,listHeader:w,...oe}};export{Ie as u};
