const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BaseEmojiPicker-Ceq4Id3x.js","assets/BaseEmojiPicker.vue_vue_type_script_setup_true_lang-BINND36q.js","assets/index-BvWZzpdy.js","assets/index-Fr33gqm_.css","assets/BaseSpinner.vue_vue_type_script_setup_true_lang-BFuHChbK.js","assets/BaseMapPreview-DAJis7OW.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/BaseMapPreview-KhQNB2ht.css","assets/ChatMessageFile-DeTzlkXT.js","assets/ChatMessageFile.vue_vue_type_script_setup_true_lang-DoSxhKbo.js","assets/BaseFilesPreviewItem.vue_vue_type_script_setup_true_lang-CjXe_Rk_.js","assets/BaseAvatar-D36Htoab.js","assets/FileManagerService-Dv6gzck7.js","assets/useAxios-DMOwfapY.js","assets/BaseAvatar-BJnla1kf.css","assets/BaseFilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-y8tKaj0O.js","assets/ChatMessageEngage-BMkxkFBa.js","assets/ChatMessageEngage-DdctgRtk.css","assets/ChatMessageReply-BJb4tAPn.js","assets/chatStore-C8hKXATz.js","assets/ChatMessageReply-DZy6Cfbo.css","assets/ChatReplyItem-CFwx3Xf3.js"])))=>i.map(i=>d[i]);
import{l as te,u as fe,r as g,bM as Fe,a9 as ye,o as we,c as E,h as ot,R as $,n as u,p as Ie,q as Se,T as b,m as C,t as P,x as i,w as s,ae as O,J as o,bP as ze,Q as ue,L as w,M as S,a0 as ut,aF as re,W as D,X as rt,Z as J,I as G,gk as Pe,bR as Ne,ac as mt,bS as Re,fo as dt,Y as N,U as Z,aG as Ve,O as Ue,gl as Ee,dF as ct,bO as qe,aN as me,fL as ft,az as ce,dS as gt,gm as vt,dT as ht,gn as pt,dQ as yt,go as bt,dP as Ct,gp as kt,dR as Mt,gq as Tt,a as $e,d9 as wt,fN as It,cy as St,bx as Rt,gr as $t,cE as zt,bN as Pt,a2 as Et,a8 as Bt,gs as Lt,ay as Me,cd as Ot,bg as At,b8 as ee,c3 as Dt,dK as Ft,v as He,aM as Nt,bk as Vt,ed as Ut,d5 as qt,al as Be,H as Ht,am as jt,gt as Qt,a6 as Gt,bf as Zt,bV as Kt,aO as Le,en as Wt,cI as Oe,gu as Ae,dN as Xt,gv as Jt}from"./index-BvWZzpdy.js";import{Q as ve,_ as Yt}from"./BaseVirtualScrollerDynamic.vue_vue_type_script_setup_true_lang-Hkpnz-V_.js";import{B as be}from"./BaseAvatar-D36Htoab.js";import{B as xt}from"./BaseFilePicker-CTV3J501.js";import{a as je,j as _t}from"./FileManagerService-Dv6gzck7.js";import{B as De}from"./BaseButton-BpQzkN3j.js";import{_ as ea}from"./BaseFilesPreviewItem.vue_vue_type_script_setup_true_lang-CjXe_Rk_.js";import{_ as Te}from"./BaseTooltip.vue_vue_type_script_setup_true_lang-C0T1tyPI.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as ta}from"./ContentItem-BC1BoODo.js";import{u as Qe,_ as aa}from"./chatStore-C8hKXATz.js";import{_ as na}from"./OpenGraphItemAlt.vue_vue_type_script_setup_true_lang-DTNG7H0V.js";import{_ as sa}from"./BaseRippleItem.vue_vue_type_script_setup_true_lang-0QbSTlRR.js";import{B as ia}from"./BaseDropdownMenu-DOehbtQi.js";import{B as la}from"./BaseCard-B_NQL-y6.js";import{_ as oa}from"./BaseInfiniteScroll.vue_vue_type_script_setup_true_lang-BONUxSw_.js";import{C as oe}from"./ClosePopup-Bp5W5fPl.js";import{_ as ua}from"./BaseLink.vue_vue_type_script_setup_true_lang-CL92y0Zo.js";import"./BaseFilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-y8tKaj0O.js";import"./useAxios-DMOwfapY.js";import"./BaseLabelValueItem.vue_vue_type_script_setup_true_lang-etAIDQvC.js";const ra={key:0,class:"row"},ma={class:"col"},da={key:1,class:"row q-py-sm"},ca={class:"row"},fa=te({__name:"ChatInput",props:{inputId:{},emojiPickerId:{default:"chat-emoji"},loading:{type:Boolean,default:!1},inputDense:{type:Boolean,default:!0},inputAvata:{type:Boolean,default:!0},miniChat:{type:Boolean,default:!1}},emits:["on-submit","on-blur","on-input-update"],setup(a,{expose:B,emit:I}){const k=re(()=>me(()=>import("./BaseEmojiPicker-Ceq4Id3x.js"),__vite__mapDeps([0,1,2,3,4]))),c=re(()=>me(()=>import("./BaseMapPreview-DAJis7OW.js"),__vite__mapDeps([5,2,3,6,7]))),M=I,{t:y}=fe(),v=g(),T=Fe(),m=g(),n=g([]),l=g(),f=g([]),L=g(),H=g(!1),ae=ye("chatInputRef");we(()=>{ge(),_()});const ge=()=>{document.addEventListener("paste",se)},ne=()=>{document.removeEventListener("paste",se)},se=async h=>{const z=h.clipboardData.items;for(let R=0;R<z.length;R++){const X=z[R];if(X.type.includes("image")){const A=X.getAsFile(),q=await je(A);f.value.push({id:null,fileMime:A.type,fileName:A.name,filePath:q||"",fileThumbnailPath:q||"",fileSize:A.size,file:A,isImage:!0})}}},de=h=>{f.value.length>0&&f.value.splice(h,1)},ie=E(()=>!!(v.value&&v.value.trim().length>0||n.value.length>0||f.value.length>0||L.value)),j=h=>{if(h&&h.shiftKey)return;const z=v.value&&v.value.trim().length>0?v.value.trim():void 0;if(!(!z&&n.value.length==0&&f.value.length==0)){if(f.value.length>0)for(const R of f.value)R.file&&n.value.push(R.file);F(z,n.value),x()}},F=(h,z,R=void 0)=>{M("on-submit",h,z,R)},Y=async h=>{h&&h.length>0&&(F(void 0,h),l.value=setTimeout(()=>{x()},350))},V=async()=>{L.value&&(F(void 0,void 0,L.value),x())},le=()=>{L.value=void 0,H.value=!1},x=()=>{v.value=void 0,L.value=void 0,n.value=[],f.value=[],H.value=!1},U=h=>{v.value||(v.value=""),v.value+=h},_=()=>{ae.value&&ae.value.focus()},K=h=>{M("on-input-update",h)},W=h=>{M("on-blur",h)};return ot(()=>{l.value&&(clearTimeout(l.value),l.value=void 0),ne()}),B({onInputFocus:_}),(h,z)=>(u(),$("div",Ie(Se(h.$attrs)),[H.value?(u(),$("div",ra,[P("div",ma,[i(o(c),{modelValue:L.value,"onUpdate:modelValue":z[0]||(z[0]=R=>L.value=R),title:o(y)("chats.shareLocation")},{side:s(()=>[i(O,{disable:h.loading||!ie.value,onClick:V,flat:"",round:"",icon:o(ze),color:"primary"},{default:s(()=>[i(ue,null,{default:s(()=>[w(S(o(y)("chats.send")),1)]),_:1})]),_:1},8,["disable","icon"]),i(O,{onClick:le,flat:"",round:"",icon:o(ut)},{default:s(()=>[i(ue,null,{default:s(()=>[w(S(o(y)("base.close")),1)]),_:1})]),_:1},8,["icon"])]),_:1},8,["modelValue","title"])])])):b("",!0),f.value&&f.value.length>0?(u(),$("div",da,[(u(!0),$(D,null,rt(f.value,(R,X)=>(u(),$("div",{class:"col-3",key:`clipboardfile-${X}`},[i(ea,{item:R,index:X,fetch:!1,dense:"","image-size":"100px","show-delete":!0,"show-size":!1,"show-name":!1,onOnRemove:de},null,8,["item","index"])]))),128))])):b("",!0),H.value?b("",!0):(u(),C(J,{key:2,dense:"",class:G(["q-mt-md",{"q-pa-none":!h.miniChat}])},{default:s(()=>[i(N,{side:""},{default:s(()=>[P("div",ca,[i(xt,{ref_key:"filePickerRef",ref:m,multiple:"",modelValue:n.value,"onUpdate:modelValue":z[1]||(z[1]=R=>n.value=R),wildcard:"",icon:o(Pe),"show-preview":!1,onOnFileAdd:Y},{default:s(()=>[i(De,{disable:h.loading,dense:"",flat:"",round:"",icon:o(Pe),size:"sm",class:"text-capitalize"},{default:s(()=>[i(Te,null,{default:s(()=>[w(S(o(y)("base.chooseFile")),1)]),_:1})]),_:1},8,["disable","icon"])]),_:1},8,["modelValue","icon"]),i(O,{disable:h.loading,dense:"",flat:"",round:"",icon:o(Ne),size:"sm"},{default:s(()=>[i(mt,null,{default:s(()=>[i(Re,null,{default:s(()=>[i(o(k),{"picker-id":h.emojiPickerId,"onOn:emojiClick":U},null,8,["picker-id"])]),_:1})]),_:1})]),_:1},8,["disable","icon"]),i(De,{disable:h.loading,dense:"",flat:"",round:"",icon:o(dt),size:"sm",onClick:z[2]||(z[2]=R=>H.value=!0)},{default:s(()=>[i(Te,null,{default:s(()=>[w(S(o(y)("chats.shareLocation")),1)]),_:1})]),_:1},8,["disable","icon"])])]),_:1}),i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[i(Ve,Ue({ref_key:"chatInputRef",ref:ae,readonly:h.loading,tabindex:"1"},h.$attrs,{outlined:"",modelValue:v.value,"onUpdate:modelValue":[z[4]||(z[4]=R=>v.value=R),K],type:"textarea",autogrow:"",dense:h.inputDense,label:o(y)("chats.typeMessage"),class:"input-emoji",onKeyup:[Ee(j,["enter"]),Ee(ct(j,["shift"]),["enter"])],onBlur:W}),qe({after:s(()=>[i(O,{disable:h.loading||!ie.value,onClick:z[3]||(z[3]=R=>j(R)),flat:"",round:"",icon:o(ze),size:h.miniChat?"sm":"md",color:"primary"},{default:s(()=>[i(Te,null,{default:s(()=>[w(S(o(y)("chats.send")),1)]),_:1})]),_:1},8,["disable","icon","size"])]),_:2},[h.inputAvata?{name:"prepend",fn:s(()=>[o(T)?.auth?.avatar?.thumbnail?(u(),C(be,{key:0,src:o(T)?.auth?.avatar?.thumbnail},null,8,["src"])):b("",!0)]),key:"0"}:void 0]),1040,["readonly","modelValue","dense","label","onKeyup"])]),_:1})]),_:1})]),_:1},8,["class"]))],16))}}),ga=he(fa,[["__scopeId","data-v-d7c904b0"]]),va={class:"row justify-center q-pa-sm q-gutter-sm"},ha={key:"btn-1",class:"btn-holder"},pa={key:"btn-2",class:"btn-holder"},ya={key:"btn-3",class:"btn-holder"},ba={key:"btn-4",class:"btn-holder"},Ca={key:"btn-5",class:"btn-holder"},ka=te({__name:"AppReactionMenu",props:{iconSize:{default:"40px"},iconZoomSize:{default:"55px"}},emits:["on:like"],setup(a,{emit:B}){const I=B,k=g(!1),c=g(!1),M=g(!1),y=g(!1),v=g(!1),T=m=>{I("on:like",m)};return(m,n)=>(u(),$("div",va,[i(ft,{appear:"","enter-active-class":"animated lightSpeedInLeft"},{default:s(()=>[P("div",ha,[i(O,{round:"",dense:"",flat:"",color:"primary",onMouseover:n[0]||(n[0]=l=>k.value=!0),onMouseleave:n[1]||(n[1]=l=>k.value=!1),onClick:n[2]||(n[2]=l=>T("LIKE"))},{default:s(()=>[i(ce,{name:k.value?o(gt):o(vt),size:k.value?m.iconZoomSize:m.iconSize},null,8,["name","size"]),i(ue,{class:"bg-primary",anchor:"top middle",self:"center middle"},{default:s(()=>n[15]||(n[15]=[w(" Like ")])),_:1})]),_:1})]),P("div",pa,[i(O,{round:"",dense:"",flat:"",color:"green",onMouseover:n[3]||(n[3]=l=>c.value=!0),onMouseleave:n[4]||(n[4]=l=>c.value=!1),onClick:n[5]||(n[5]=l=>T("FIGHTING"))},{default:s(()=>[i(ce,{name:c.value?o(ht):o(pt),size:c.value?m.iconZoomSize:m.iconSize},null,8,["name","size"]),i(ue,{class:"bg-green",anchor:"top middle",self:"center middle"},{default:s(()=>n[16]||(n[16]=[w(" Give going ")])),_:1})]),_:1})]),P("div",ya,[i(O,{round:"",dense:"",flat:"",color:"orange",onMouseover:n[6]||(n[6]=l=>M.value=!0),onMouseleave:n[7]||(n[7]=l=>M.value=!1),onClick:n[8]||(n[8]=l=>T("LAUGH"))},{default:s(()=>[i(ce,{name:M.value?o(yt):o(bt),size:M.value?m.iconZoomSize:m.iconSize},null,8,["name","size"]),i(ue,{class:"bg-orange",anchor:"top middle",self:"center middle"},{default:s(()=>n[17]||(n[17]=[w(" LOL ")])),_:1})]),_:1})]),P("div",ba,[i(O,{round:"",dense:"",flat:"",color:"pink",onMouseover:n[9]||(n[9]=l=>y.value=!0),onMouseleave:n[10]||(n[10]=l=>y.value=!1),onClick:n[11]||(n[11]=l=>T("CARE"))},{default:s(()=>[i(ce,{name:y.value?o(Ct):o(kt),size:y.value?m.iconZoomSize:m.iconSize},null,8,["name","size"]),i(ue,{class:"bg-pink",anchor:"top middle",self:"center middle"},{default:s(()=>n[18]||(n[18]=[w(" Care ")])),_:1})]),_:1})]),P("div",Ca,[i(O,{round:"",dense:"",flat:"",color:"deep-purple",onMouseover:n[12]||(n[12]=l=>v.value=!0),onMouseleave:n[13]||(n[13]=l=>v.value=!1),onClick:n[14]||(n[14]=l=>T("SAD"))},{default:s(()=>[i(ce,{name:v.value?o(Mt):o(Tt),size:v.value?m.iconZoomSize:m.iconSize},null,8,["name","size"]),i(ue,{class:"bg-deep-purple",anchor:"top middle",self:"center middle"},{default:s(()=>n[19]||(n[19]=[w(" Sad ")])),_:1})]),_:1})])]),_:1})]))}}),Ma=he(ka,[["__scopeId","data-v-0806a157"]]),Ta=te({__name:"ChatMessageMenu",props:{chatId:{},sent:{type:Boolean},showCopy:{type:Boolean,default:!0},messageType:{}},emits:["message-delete","message-unsend","message-copy","on-hide","message-reply","message-share","on-share-post","on-share-action"],setup(a,{emit:B}){const I=B,{appConfirm:k}=$e(),{t:c}=fe(),M=[{label:c("chats.reply"),value:1,icon:wt,onHandle(){m()}},{label:c("chats.share"),value:2,icon:It,onHandle(){n()}},{label:c("base.copy"),value:3,icon:St,onHandle(){T()}},{label:c("base.delete"),value:4,icon:Rt,onHandle(){y()}},{label:c("chats.unsendMessage"),value:5,icon:$t,onHandle(){v()}}];we(()=>{a.showCopy||M.splice(2,1),a.sent||M.splice(4,1)});const y=async()=>{await k(c("app.monogram"),c("chats.deleteChatConfirm"))&&I("message-delete")},v=async()=>{await k(c("app.monogram"),c("chats.unsendMessageConfirm"))&&I("message-unsend")},T=async()=>{I("message-copy")},m=()=>{I("message-reply")},n=()=>{I("message-share")};return(l,f)=>(u(),C(ia,{items:M,onOnHide:f[0]||(f[0]=L=>l.$emit("on-hide"))},{default:s(()=>[i(O,{flat:"",round:"",dense:"",size:"sm",icon:o(zt),class:"text-muted",style:{opacity:"0.5"}},null,8,["icon"])]),_:1}))}}),wa=["id"],Ia={class:"col-12"},Sa={class:"text-muted"},Ra={class:"text-muted"},$a={class:"text-muted"},za={key:0,class:"text-muted text-caption"},Pa={class:"row items-center",style:{"z-index":"99999"}},Ea=te({__name:"ChatMessageItem",props:{item:{},chatType:{},index:{},showSenderAvatar:{type:Boolean,default:!1},showSenderName:{type:Boolean,default:!1},label:{},haveReply:{type:Boolean,default:!1},miniChat:{type:Boolean,default:!1},highLightText:{}},emits:["message-reaction","message-delete","message-unsend","message-reply","on-open-seen-dialog","message-share"],setup(a,{emit:B}){const I=re(()=>me(()=>import("./ChatMessageFile-DeTzlkXT.js"),__vite__mapDeps([8,9,2,3,10,11,12,13,6,14,15]))),k=re(()=>me(()=>import("./ChatMessageEngage-BMkxkFBa.js"),__vite__mapDeps([16,2,3,6,17]))),c=re(()=>me(()=>import("./BaseMapPreview-DAJis7OW.js"),__vite__mapDeps([5,2,3,6,7]))),M=B,y=Qe(),{screen:v,dark:T}=Pt(),{t:m}=fe(),{appFormatDateTimeAuto:n,writeToClipboard:l}=$e();g(!1);const f=g(!1),L=g(null),H=E(()=>a.item.sent?"absolute-bottom-left q-text-black":"absolute-bottom-right q-text-black"),ae=E(()=>a.item.sent?"left: -55px;":"right: -50px;"),ge=E(()=>a.item.sent?"absolute-bottom-right":"absolute-bottom-left"),ne=E(()=>a.item.sent?a.item.chatMsg?"bottom:-25px":"bottom:-15px":a.item.chatMsg?"bottom:-55px":"bottom:-25px"),se=E(()=>a.item.sent?a.showSenderName?m("base.you"):"":a.item.sendUser?.name),de=E(()=>!a.item?.files||a.item.files.length==0?[]:a.item.files.filter(e=>e.fileManager&&e.fileManager.image)),ie=E(()=>a.item.files?a.item.files.filter(e=>e.fileManager&&!e.fileManager.image):[]),j=E(()=>a.item.unsend||a.item.chatMessageType=="LEAVE"||a.item.chatMessageType=="INVITE"),F=E(()=>de.value.length>0&&!a.item.chatMsg&&ie.value.length==0),Y=E(()=>j.value?"message-unsend":F.value?"message-transparent":a.item.sent?"message-sent":"message-received"),V=E(()=>a.item.sent?"#":`user/${a.item.sendUser?.id}`),le=E(()=>a.item.reactionEngage&&a.item.reactionEngage.length>0?"q-mb-xl":"q-mb-sm"),x=E(()=>{if(j.value||!a.item.files)return;if(a.item.chatMessageType=="LOCATION")return a.miniChat?"10":"9";const e=de.value.length,Q=ie.value.length;if(a.miniChat&&(e>0||Q>0))return"10";if(v.gt.xs){if(e==1||e==2)return"4";if(e>0)return"6"}else if(e>0)return"8"}),U=E(()=>j.value?T.isActive?"grey-4":"grey-7":a.item.sent?"grey-10":T.isActive?"white":"black"),_=async()=>{a.item.id&&M("message-delete",a.item.id)},K=async()=>{a.item.id&&M("message-unsend",a.item.id)},W=async()=>{a.item.id&&M("message-reply",a.item.id)},h=async()=>{a.item.id&&M("message-share",a.item.id)},z=async()=>{console.log("onCopy"),a.item.chatMsg&&await l(a.item.chatMsg)},R=async e=>{a.item.id&&M("message-reaction",e,a.item.id)},X=()=>{!a.item.id||!a.item?.readCount||a.item.readCount==0||!a.item.sent||a.chatType=="PERSONAL"||M("on-open-seen-dialog",a.item.id,a.item.readCount)},A=e=>new Promise(Q=>{L.value=setTimeout(()=>{f.value=e,Q(!0)},500)}),q=async()=>{f.value=!0,await A(!1),await A(!0),await A(!1),await A(!0),await A(!1),clearTimeout(L.value),L.value=null,y.messageIdFocus=void 0},Ce=e=>{console.log("onReactionClick",e)};return Et(y,e=>{a.item&&a.item.id&&e&&e.messageIdFocus&&e.messageIdFocus==a.item.id&&q()}),(e,Q)=>{const pe=Bt("router-link");return e.item&&e.index!=null?(u(),$("div",Ue({key:0},e.$attrs,{class:["row",{"holder-recive":!e.item.sent&&e.miniChat,"holder-sent":e.item.sent&&e.miniChat}],id:`${o(Lt)}-${e.item.id}`}),[P("div",Ia,[e.item.onlyLabel?(u(),$(D,{key:0},[e.item.chatMsg?(u(),C(ve,{key:0},{label:s(()=>[P("span",Sa,S(e.item.chatMsg),1)]),_:1})):b("",!0)],64)):(u(),$(D,{key:1},[e.label?(u(),C(ve,{key:0},{label:s(()=>[P("span",Ra,S(e.label),1)]),_:1})):b("",!0),e.item?(u(),C(ve,{key:1,"text-color":U.value,"bg-color":Y.value,class:G(le.value),size:x.value,sent:e.item.sent},qe({name:s(()=>[P("div",$a,[!e.item.sent&&e.chatType!="PERSONAL"&&(!e.haveReply||e.item.unsend)?(u(),$(D,{key:0},[V.value?(u(),C(pe,{key:0,to:V.value},{default:s(()=>[w(S(se.value),1)]),_:1},8,["to"])):b("",!0)],64)):b("",!0)])]),stamp:s(()=>[P("span",{class:G(["text-caption",{"text-muted":o(T).isActive&&F.value}])},S(o(n)(e.item.msgDateTime)),3)]),default:s(()=>[P("div",{class:G({"message-focus":f.value})},[!e.item.sent&&e.chatType!="PERSONAL"&&e.haveReply&&!e.item.unsend?(u(),$("div",za,S(se.value),1)):b("",!0),j.value?e.item.chatMsg?(u(),$(D,{key:2},[w(S(e.item.chatMsg),1)],64)):(u(),$(D,{key:3},[w(S(o(m)("chats.unsend")),1)],64)):(u(),$(D,{key:1},[e.item.chatMessageType!="LOCATION"?(u(),$(D,{key:0},[e.item.chatMsg?(u(),C(ta,{key:0,class:G([o(v).gt.xs?"text-div-web":"text-div-mobile","q-pa-xs"]),"wrap-text":!0,limit:20,"is-escape-html":"","high-light-text":e.highLightText||"",content:e.item.chatMsg,"hashtag-urlify":!1,"content-id":`chat-message-${e.item.id}-${e.index}-content`,"link-style":(e.item.sent,"app-text-link"),"text-style":"text-black"},null,8,["class","high-light-text","content","content-id","link-style"])):b("",!0),e.item.chatMsg?(u(),C(na,{key:1,class:"q-pa-sm",style:Me({maxWidth:o(v).xs?"60vw":e.miniChat?"13vw":"25vw"}),content:e.item.chatMsg,short:!e.miniChat,"image-max-height":e.miniChat?"120px":"150px","image-size":e.miniChat?"50px":"120px","show-bg":!1},null,8,["style","content","short","image-max-height","image-size"])):b("",!0),e.item.files&&e.item.files.length>0&&e.item.id?(u(),C(o(I),{key:2,class:"q-mt-sm","mini-chat":e.miniChat,"chat-id":e.item.id,files:e.item.files,sent:e.item.sent},null,8,["mini-chat","chat-id","files","sent"])):b("",!0)],64)):(u(),C(o(c),{key:1,"preview-src":e.item.chatMsg,preview:"",height:e.miniChat?140:150,zoom:2},null,8,["preview-src","height"])),e.item.reactionEngage&&e.item.reactionEngage.length>0?(u(),$("div",{key:2,class:G(ge.value),style:Me([ne.value,{width:"175px"}])},[e.item.reactionEngage&&e.item.reactionEngage.length>0&&e.item.id?(u(),C(o(k),{key:0,"chat-id":e.item.id,class:G(e.item.sent?"float-right":"float-left"),items:e.item.reactionEngage,onOnClick:Ce},null,8,["chat-id","class","items"])):b("",!0)],6)):b("",!0),e.item.sent&&e.item.readCount>0?(u(),C(sa,{key:3,class:"absolute-bottom-left text-muted text-weight-light text-caption app-border-radius q-px-xs","cursor-pointer":e.chatType!="PERSONAL",style:{left:"-50px",bottom:"25px"},onClick:X},{default:s(()=>[w(S(`${o(m)("chats.read")} ${e.chatType=="GROUP"?o(Ot)(e.item.readCount):""}`),1)]),_:1},8,["cursor-pointer"])):b("",!0),e.item.id?(u(),$("div",{key:4,class:G(H.value),style:Me(ae.value)},[P("div",Pa,[i(Ta,{"chat-id":e.item.id,sent:e.item.sent,"show-copy":e.item.chatMsg!=null&&!0&&e.item.chatMsg.length>0,"message-type":e.item.chatMessageType,onMessageCopy:z,onMessageDelete:_,onMessageUnsend:K,onMessageReply:W,onMessageShare:h},null,8,["chat-id","sent","show-copy","message-type"]),i(O,{flat:"",round:"",dense:"",size:"sm",icon:o(Ne),class:G(e.item.liked?"text-amber-9":"text-muted")},{default:s(()=>[i(Re,{"auto-close":"",anchor:"top end",self:"bottom middle",style:{height:"65px",width:"265px"}},{default:s(()=>[i(Ma,{"onOn:like":R})]),_:1})]),_:1},8,["icon","class"])])],6)):b("",!0)],64))],2)]),_:2},[!e.item.sent||e.showSenderAvatar?{name:"avatar",fn:s(()=>[V.value&&e.item.sendUser?.avatar?.thumbnail?(u(),C(pe,{key:0,to:V.value},{default:s(()=>[i(be,{class:"q-mr-xs",src:e.item.sendUser?.avatar?.thumbnail,"fetch-image":""},null,8,["src"])]),_:1},8,["to"])):b("",!0)]),key:"0"}:void 0]),1032,["text-color","bg-color","class","size","sent"])):b("",!0)],64))])],16,wa)):b("",!0)}}}),Ba=he(Ea,[["__scopeId","data-v-7c08e8f0"]]),La=te({__name:"ChatMessage",props:{item:{},chatType:{},index:{},showSenderAvatar:{type:Boolean,default:!1},showSenderName:{type:Boolean,default:!1},miniChat:{type:Boolean,default:!1},label:{},highLightText:{}},emits:["message-reaction","message-delete","message-unsend","message-reply","on-open-seen-dialog","message-share","on-focus-message-reply"],setup(a,{emit:B}){const I=re(()=>me(()=>import("./ChatMessageReply-BJb4tAPn.js"),__vite__mapDeps([18,2,3,11,12,13,6,14,19,20]))),k=B,c=async l=>{a.item.id&&k("message-reaction",l,a.item.id)},M=async()=>{a.item.id&&k("message-delete",a.item.id)},y=async()=>{a.item.id&&k("message-unsend",a.item.id)},v=async()=>{a.item.id&&k("message-reply",a.item.id)},T=async()=>{a.item.id&&k("message-share",a.item.id)},m=(l,f)=>{k("on-open-seen-dialog",l,f)},n=l=>{k("on-focus-message-reply",l)};return(l,f)=>(u(),$(D,null,[l.item.dtoReplyTo&&!l.item.unsend?(u(),C(o(I),{key:0,item:l.item.dtoReplyTo,sent:l.item.sent,onOnClick:n,"mini-chat":l.miniChat},null,8,["item","sent","mini-chat"])):b("",!0),i(Ba,{item:l.item,index:l.index,"chat-type":l.chatType,"have-reply":l.item.dtoReplyTo!=null,"mini-chat":l.miniChat,"high-light-text":l.highLightText,"show-sender-avatar":l.showSenderAvatar,"show-sender-name":l.showSenderName,onMessageDelete:M,onMessageUnsend:y,onMessageReply:v,onMessageReaction:c,onOnOpenSeenDialog:m,onMessageShare:T},null,8,["item","index","chat-type","have-reply","mini-chat","high-light-text","show-sender-avatar","show-sender-name"])],64))}}),Oa=te({__name:"ChatMenu",props:{chatId:{},pin:{type:Boolean},favorite:{type:Boolean},muteNotify:{type:Boolean},chatType:{}},emits:["toggle-mute","toggle-pin","toggle-fav","toggle-chat","delete-chat","leave-group","invite-people","on-close"],setup(a,{emit:B}){const I=B,{appConfirm:k}=$e(),{t:c}=fe(),M=()=>{a.chatId&&I("on-close",a.chatId)},y=()=>{a.chatId&&I("toggle-mute",a.chatId)},v=()=>{a.chatId&&I("toggle-pin",a.chatId)},T=()=>{a.chatId&&I("toggle-fav",a.chatId)},m=()=>{a.chatId&&I("invite-people",a.chatId)},n=async()=>{if(!a.chatId)return;await k(c("app.monogram"),c("chats.deleteChatConfirm"))&&I("delete-chat",a.chatId)},l=async()=>{if(!a.chatId)return;await k(c("app.monogram"),c("chats.leaveGroupConfirm"))&&I("leave-group",a.chatId)};return(f,L)=>(u(),C(Re,Ie(Se(f.$attrs)),{default:s(()=>[i(At,{dense:""},{default:s(()=>[ee((u(),C(J,{clickable:"",onClick:y},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[w(S(f.muteNotify?o(c)("chats.unmuteNotify"):o(c)("chats.muteNotify")),1)]),_:1})]),_:1})]),_:1})),[[oe]]),ee((u(),C(J,{clickable:"",onClick:v},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[w(S(f.pin?o(c)("chats.unpin"):o(c)("chats.pin")),1)]),_:1})]),_:1})]),_:1})),[[oe]]),ee((u(),C(J,{clickable:"",onClick:T},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[w(S(f.favorite?o(c)("chats.unfavorite"):o(c)("chats.favorite")),1)]),_:1})]),_:1})]),_:1})),[[oe]]),f.chatType=="GROUP"?ee((u(),C(J,{key:0,clickable:"",onClick:m},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[w(S(o(c)("chats.invite")),1)]),_:1})]),_:1})]),_:1})),[[oe]]):b("",!0),ee((u(),C(J,{clickable:"",onClick:n},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,{class:"text-negative"},{default:s(()=>[w(S(o(c)("base.delete")),1)]),_:1})]),_:1})]),_:1})),[[oe]]),f.chatType=="GROUP"?ee((u(),C(J,{key:1,clickable:"",onClick:l},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,{class:"text-negative"},{default:s(()=>[w(S(o(c)("chats.leaveGroup")),1)]),_:1})]),_:1})]),_:1})),[[oe]]):b("",!0),ee((u(),C(J,{clickable:"",onClick:M},{default:s(()=>[i(N,null,{default:s(()=>[i(Z,null,{default:s(()=>[w(S(o(c)("base.close")),1)]),_:1})]),_:1})]),_:1})),[[oe]])]),_:1})]),_:1},16))}}),Aa={class:"row"},Da=te({__name:"ChatContentHeader",props:{miniChat:{type:Boolean,default:!1},miniminze:{type:Boolean,default:!1},item:{},chatWith:{}},emits:["toggle-mute","toggle-pin","toggle-fav","toggle-chat","delete-chat","leave-group","invite-people","on-close"],setup(a){const B=g(0),{t:I}=fe(),k=g(!1),c=g(""),M=E(()=>a.chatWith?`/user/${a.chatWith.id}`:"#"),y=()=>{c.value=""},v=()=>{k.value=!k.value,k.value||y()},T=()=>{const m=c.value?c.value.trim():void 0;m||(!m||m.length==0)&&y()};return(m,n)=>(u(),C(J,{class:"card-top-bg"},{default:s(()=>[m.miniChat&&m.miniminze&&B.value>0?(u(),C(Dt,{key:0,color:"negative",floating:""},{default:s(()=>[w(S(B.value),1)]),_:1})):b("",!0),i(N,{avatar:""},{default:s(()=>[i(aa,{item:m.item},null,8,["item"])]),_:1}),i(N,null,{default:s(()=>[i(Z,{lines:"2"},{default:s(()=>[i(ua,{to:M.value},{default:s(()=>[w(S(m.item.groupName),1)]),_:1},8,["to"]),m.item.favorite?(u(),C(ce,{key:0,color:"amber-8",size:"14px",class:"q-ml-xs q-mb-xs",name:o(Ft)},null,8,["name"])):b("",!0)]),_:1}),i(Z,{caption:"",lines:"1"},{default:s(()=>[w(S(m.item.chatType=="PERSONAL"?"Software engineer":"Group"),1)]),_:1})]),_:1}),i(N,{side:""},{default:s(()=>[P("div",Aa,[He(m.$slots,"headerRight",{},()=>[m.miniChat?b("",!0):(u(),$(D,{key:0},[i(Nt,{onSubmit:T},{default:s(()=>[k.value?(u(),C(Ve,{key:0,modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=l=>c.value=l),outlined:"",dense:"",clearable:"",onClear:y,placeholder:o(I)("chats.searchMessage")},null,8,["modelValue","placeholder"])):b("",!0)]),_:1}),i(O,{onClick:v,flat:"",round:"",icon:o(Vt),size:"sm"},null,8,["icon"])],64)),m.item.id?(u(),C(O,{key:1,flat:"",round:"",icon:m.miniChat?o(qt):o(Ut),size:"sm"},{default:s(()=>[i(Oa,{"chat-id":m.item.id,"chat-type":m.item.chatType,pin:m.item.pin,"mute-notify":m.item.muteNotify,favorite:m.item.favorite,"mini-chat":m.miniChat,onTogglePin:n[1]||(n[1]=l=>m.$emit("toggle-pin",l)),onToggleMute:n[2]||(n[2]=l=>m.$emit("toggle-mute",l)),onToggleFav:n[3]||(n[3]=l=>m.$emit("toggle-fav",l)),onDeleteChat:n[4]||(n[4]=l=>m.$emit("delete-chat",l)),onLeaveGroup:n[5]||(n[5]=l=>m.$emit("leave-group",l)),onInvitePeople:n[6]||(n[6]=l=>m.$emit("invite-people",l)),onOnClose:n[7]||(n[7]=l=>m.$emit("on-close",l))},null,8,["chat-id","chat-type","pin","mute-notify","favorite","mini-chat"])]),_:1},8,["icon"])):b("",!0)],!0)])]),_:3})]),_:3}))}}),Fa=he(Da,[["__scopeId","data-v-1ae1ed4e"]]),Na={class:"text-center"},Va={key:1,class:"row justify-center absolute full-width",style:{bottom:"50px"}},Ua=te({__name:"ChatContent",props:Be({showHeader:{type:Boolean,default:!0},square:{type:Boolean,default:!1},inputDense:{type:Boolean},inputAvata:{type:Boolean,default:!0},scrollAreaHeight:{default:"65vh"},miniChat:{type:Boolean,default:!1},miniminze:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:Be(["toggle-mute","toggle-pin","toggle-fav","toggle-chat","delete-chat","leave-group","on-close"],["update:modelValue"]),setup(a,{emit:B}){const I=re(()=>me(()=>import("./ChatReplyItem-CFwx3Xf3.js"),__vite__mapDeps([21,2,3,11,12,13,6,14]))),{t:k}=fe(),{isDark:c}=Ht();Qe();const M=Fe(),y=jt(a,"modelValue"),v=g([...Qt.dataList]),T=ye("chatInfinityScrollRef"),m=g(""),n=g({chatMsg:null,fileIds:[],chatMessageType:null}),l=g(!1),f=g(),L=g(!1),H=g(),ae=g(!1),ge=g(0),ne=g(!0),se=g(),de=ye("chatContentInputRef"),ie=g(!1);g(0);const j=g(),F=ye("scrollerChatRef"),Y=g(!0),V=g(!1),le=g(0),x=g(0),U=g(1e3),_=g(!1),K=g(null),W=g(null);we(async()=>{h()});const h=async()=>{K.value=setTimeout(()=>{q(),K.value=setTimeout(()=>{Y.value=!1},1e3)},1500)},z=(t,r)=>{console.log("onInfiniteChatVirtual",t),setTimeout(async()=>{r(),R()},1e3)},R=()=>{T.value&&(T.value.stop(),Y.value=!0)},X=()=>{T.value&&(T.value.resume(),Y.value=!1)},A=t=>{t&&(_.value=t.visibleEndIndex!=t.viewEndIndex)},q=()=>{_.value=!1,F.value&&F.value.onScrollToBottom()},Ce=t=>{t!=null&&F.value&&F.value.onScrollToItem(t)},e=t=>{console.log("invitePeople",t)},Q=t=>new Promise(r=>{const d=v.value.findIndex(p=>p.id==t);r(d)}),pe=async t=>new Promise(r=>{const d=v.value.find(p=>p.id==t);r(d)}),ke=t=>v.value[t],Ge=t=>new Promise(r=>{t>=0&&v.value.splice(t,1),r(!0)}),Ze=async t=>{console.log("messageDelete",t),R();const r=await Q(t);r>=0&&await Ge(r),q(),X()},Ke=async(t,r=!0)=>{if(console.log("messageUnsend",{messageId:t,unsendToServer:r}),!t)return;const d=await Q(t);if(d>=0){const p=ke(d);p&&(p.unsend=!0,p.chatMsg=void 0,p.files=[],p.reactionEngage=[])}},We=async(t,r)=>{console.log("messageReaction",{l:t,messageId:r});const d=await Q(r);if(d>=0){const p=ke(d);p&&(p.liked?p.liked&&p.emojiType==t?(p.liked=!1,p.emojiType=null):p.emojiType=t:(p.liked=!0,p.emojiType=t),p.reactionEngage||(p.reactionEngage=[]),p.reactionEngage.find(lt=>lt.emojiType==t)||p.reactionEngage.push({emojiType:t,total:1}))}},Xe=async t=>{console.log("messageReply",t),ne.value=!1,se.value=setTimeout(()=>{ne.value=!0},100);const r=await Q(t);if(r>=0){const d=ke(r);d&&(f.value=d)}},Je=()=>{f.value=void 0},Ye=(t,r)=>{console.log("onOpenSeenDialog",{messageId:t,readCount:r}),t&&(H.value=t,ge.value=r,ae.value=!0)},xe=async t=>{if(!t)return;const r=await Q(t);r>=0?Ce(r):(H.value=t,L.value=!0)},_e=async t=>{if(console.log("onShare",t),!t)return;const r=await pe(t);r&&(j.value=r,ie.value=!0)},et=async(t,r,d)=>{if(!y.value||!y.value?.id||!t&&!r&&!d)return;q(),V.value=!0,console.log("onSendMessage",{message:t,files:r,mapLatlong:d}),t&&(n.value.chatMsg=t),d&&(n.value.chatMsg=d,n.value.chatMessageType="LOCATION"),f.value&&f.value?.id&&(n.value.replyToId=f.value.id);const p=await tt(r);p.length>0&&(n.value.chatMessageType="IMAGE"),await nt(p),q(),await st(),q(),it()},tt=async t=>{const r=[];if(t&&t.length>0){for(const d of t){const p=await at(d);p&&r.push(p)}return new Promise(d=>d(r))}else return new Promise(d=>d(r))},at=async t=>{const r=_t(t);let d;return r?(d=await je(t),U.value++,new Promise(p=>p({id:U.value,fileManager:{id:U.value,fileMime:t.type,fileName:t.name,filePath:d||"",fileThumbnailPath:"",fileSize:t.size+"",functionId:0,isImage:r,image:r,file:t}}))):new Promise(p=>p(null))},nt=t=>{if(!n.value)return new Promise(d=>d(!0));U.value++;const r={id:U.value,chatMsg:n.value.chatMsg,msgDateTime:Oe(Ae),groupId:17,readCount:0,unsend:!1,sent:!0,sendUser:M.auth,files:t,liked:!1,emojiType:null,reactionEngage:[],dtoReplyTo:f.value||null,chatMessageType:n.value.chatMessageType||"TEXT"};return console.log("createItem",r),new Promise(d=>{W.value=setTimeout(()=>{V.value=!1,v.value.push(r),d(!0)},1e3)})},st=()=>{l.value=!0,U.value++;const t={id:U.value,chatMsg:"Doing fine, how r you?",msgDateTime:Oe(Ae),groupId:17,readCount:10,unsend:!1,sent:!1,sendUser:Xt[Jt(0,15)],files:[],liked:!1,emojiType:null,reactionEngage:[],dtoReplyTo:f.value||null,chatMessageType:"TEXT"};return new Promise(r=>{W.value=setTimeout(()=>{l.value=!1,v.value.push(t),r(!0)},1e3)})},it=()=>{n.value.fileIds=[],n.value.chatMsg=null,n.value.replyToId=null,n.value.chatMessageType=void 0,f.value=void 0,le.value=0,x.value=0};return Gt(()=>{K.value&&(clearTimeout(K.value),K.value=null),W.value&&(clearTimeout(W.value),W.value=null)}),(t,r)=>(u(),$("div",Ie(Se(t.$attrs)),[y.value?(u(),C(la,{key:0,flat:"",bordered:!t.square,class:G(["card-bg",{"card-minipage-style":t.miniChat}]),square:t.square,margin:!1},{default:s(()=>[t.showHeader?(u(),$(D,{key:0},[i(Fa,{item:y.value,"mini-chat":t.miniChat,miniminze:t.miniminze,onTogglePin:r[0]||(r[0]=d=>t.$emit("toggle-pin",d)),onToggleMute:r[1]||(r[1]=d=>t.$emit("toggle-mute",d)),onToggleFav:r[2]||(r[2]=d=>t.$emit("toggle-fav",d)),onDeleteChat:r[3]||(r[3]=d=>t.$emit("delete-chat",d)),onLeaveGroup:r[4]||(r[4]=d=>t.$emit("leave-group",d)),onInvitePeople:e,onOnClose:r[5]||(r[5]=d=>t.$emit("on-close",d))},{headerRight:s(()=>[He(t.$slots,"headerRight",{},void 0,!0)]),_:3},8,["item","mini-chat","miniminze"]),i(Zt)],64)):b("",!0),ee(P("div",null,[i(Yt,{id:"scroll-chat-target-id",ref_key:"scrollerChatRef",ref:F,class:"q-pa-sm","key-field":"id",items:v.value,"min-item-size":24,"scroll-area-height":t.scrollAreaHeight,onOnUpdate:A},{slotBefore:s(()=>[i(oa,{ref_key:"chatInfinityScrollRef",ref:T,"scroll-target":"#scroll-chat-target-id",reverse:"",disable:Y.value,offset:0,onOnInfinite:z},null,8,["disable"])]),default:s(({item:d,index:p})=>[(u(),C(La,{key:`message-${d.id}-${p}`,item:d,index:p,"chat-type":y.value.chatType,"mini-chat":t.miniChat,"high-light-text":m.value,onMessageReaction:We,onMessageDelete:Ze,onMessageUnsend:Ke,onMessageReply:Xe,onOnOpenSeenDialog:Ye,onOnFocusMessageReply:xe,onMessageShare:_e},null,8,["item","index","chat-type","mini-chat","high-light-text"]))]),slotAfter:s(()=>[V.value?(u(),C(ve,{key:0,name:o(k)("base.you"),"bg-color":"message-sent",sent:""},{avatar:s(()=>[o(M)?.auth?.avatar?.thumbnail?(u(),C(be,{key:0,class:"q-message-avatar q-message-avatar--sent",src:o(M)?.auth?.avatar?.thumbnail},null,8,["src"])):b("",!0)]),default:s(()=>[P("div",null,[le.value>0?(u(),$(D,{key:0},[w(S(o(k)("chats.sendFileFmt",{success:x.value,total:le.value})),1)],64)):(u(),$(D,{key:1},[w(S(o(k)("chats.sendingMessage")),1)],64)),i(Le,{class:"q-ml-sm",size:"2rem"})])]),_:1},8,["name"])):b("",!0),l.value?(u(),C(ve,{key:1,"bg-color":"message-received",sent:!1},{avatar:s(()=>[i(be,{class:"q-mr-xs",src:"https://cdn.quasar.dev/img/avatar4.jpg"})]),default:s(()=>[P("div",Na,[i(Le,{size:"2rem",color:"primary"})])]),_:1})):b("",!0)]),_:1},8,["items","scroll-area-height"])],512),[[Kt,!t.miniminze]]),_.value&&!t.miniminze?(u(),$("div",Va,[i(O,{round:"",color:o(c)?"black":"white","text-color":o(c)?"white":"black",onClick:q,icon:o(Wt)},null,8,["color","text-color","icon"])])):b("",!0)]),_:3},8,["bordered","class","square"])):b("",!0),!t.miniminze&&f.value?(u(),C(o(I),{key:1,item:f.value,onOnClose:Je},null,8,["item"])):b("",!0),!t.miniminze&&y.value&&y.value.id&&ne.value?(u(),C(ga,{key:2,ref_key:"chatContentInputRef",ref:de,"input-id":y.value.id,"mini-chat":t.miniChat,"emoji-picker-id":`chat-message-emoji-${y.value.id}`,loading:V.value,onOnSubmit:et,"input-dense":!0,"input-avata":t.inputAvata},null,8,["input-id","mini-chat","emoji-picker-id","loading","input-avata"])):b("",!0)],16))}}),mn=he(Ua,[["__scopeId","data-v-aefe88c2"]]);export{mn as default};
