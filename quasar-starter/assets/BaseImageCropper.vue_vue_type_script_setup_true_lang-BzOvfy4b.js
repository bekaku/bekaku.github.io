import{l as V,u as W,a as N,r as d,ab as y,aP as E,a9 as Q,R as h,n as g,t as n,az as D,T as k,W as A,aQ as Z,J as o,x as t,aR as J,aS as X,aT as G,aU as H,aV as K,aW as M,v as Y,w as _,aX as v,ao as ee}from"./index--rRessbS.js";import{b as ae}from"./FileManagerService-CXiPGXBm.js";import{B as oe}from"./BaseFilePicker-BXZrxDRb.js";import{_ as ne}from"./BaseScrollArea.vue_vue_type_script_setup_true_lang-DygCZjl9.js";import{B as r}from"./BaseButton-BdMngQoy.js";const te={class:"row"},le={class:"col-12 col-md-8 q-pt-md q-pl-sm"},ie=["disabled"],se=["src"],re=["aspect-ratio"],ce={class:"q-pa-sm row justify-around"},de={class:"col-12 col-md-4"},ue={class:"q-pa-sm"},pe={class:"q-mt-md"},ve={key:0,class:"cropper-viewers row q-gutter-sm"},me={class:"q-pa-md"},Ce=V({__name:"BaseImageCropper",props:{ratio:{default:1},disabled:{type:Boolean,default:!1},initialSrc:{},width:{default:"100%"},height:{default:"550px"},clearOnSubmit:{type:Boolean,default:!1},cropWidth:{default:960}},emits:["on-close","on-submit","on-cropend"],setup(c,{emit:B}){const b=B,{t:S}=W(),{appToast:R}=N(),u=d(null),x=d(!1),w=d(!1),l=d(),T=y("canvasRef"),i=y("canvasImg"),p=y("selectionRef"),m=d(null),f=d(c.initialSrc);E(()=>{c.initialSrc&&i.value&&(console.log("watchEffetch initialSrc :",c.initialSrc),f.value=c.initialSrc,C())});const q=()=>{z(),u.value=null,b("on-close"),x.value=!1},F=e=>{e&&e.length>0&&(u.value=e[0],/^image\/\w+/.test(u.value.type)?(f.value=URL.createObjectURL(u.value),C()):R("Please choose an image file.",{type:"negative"}))},I=e=>{},P=e=>{},j=e=>{},L=e=>{},O=e=>{C()},$=async()=>{if(!p.value)return new Promise(a=>{a(null)});const e=await p.value.$toCanvas({beforeDraw:(a,s)=>{a.imageSmoothingQuality="high"},width:c.cropWidth});return new Promise(a=>{a(e)})},C=async()=>{m.value=setTimeout(async()=>{const e=await $();e&&(l.value=e.toDataURL("image/jpeg"),l.value&&b("on-cropend",l.value))},500)},U=async()=>{const e=await $();e&&(w.value=!0,e.toBlob(async a=>{const s=await ae(a,u.value.name);w.value=!1,b("on-submit",s),c.clearOnSubmit&&q()},"image/jpeg"))},z=()=>{p.value&&p.value.$clear(),m.value&&(clearTimeout(m.value),m.value=null)};return Q(()=>{z()}),(e,a)=>(g(),h("div",te,[n("div",le,[n("cropper-canvas",{id:"cropperSelection",ref_key:"canvasRef",ref:T,style:D({display:"block",maxWidth:e.width,height:e.height}),disabled:e.disabled,background:"",onAction:P,onActionstart:j,onActionmove:L,onActionend:O},[f.value?(g(),h(A,{key:0},[n("cropper-image",{ref_key:"canvasImg",ref:i,src:f.value,alt:"Picture",rotatable:"",scalable:"",skewable:"",translatable:""},null,8,se),a[7]||(a[7]=n("cropper-shade",{hidden:""},null,-1)),a[8]||(a[8]=n("cropper-handle",{action:"select",plain:""},null,-1)),n("cropper-selection",{ref_key:"selectionRef",ref:p,"initial-coverage":"0.5","initial-aspect-ratio":"1.5",movable:"",resizable:"","aspect-ratio":e.ratio,onChange:I},a[6]||(a[6]=[n("cropper-grid",{role:"grid","theme-color":"#2e86de",covered:""},null,-1),n("cropper-crosshair",{centered:""},null,-1),n("cropper-handle",{action:"move","theme-color":"rgba(255, 255, 255, 0.35)"},null,-1),Z('<cropper-handle action="n-resize"></cropper-handle><cropper-handle action="e-resize"></cropper-handle><cropper-handle action="s-resize"></cropper-handle><cropper-handle action="w-resize"></cropper-handle><cropper-handle action="ne-resize"></cropper-handle><cropper-handle action="nw-resize"></cropper-handle><cropper-handle action="se-resize"></cropper-handle><cropper-handle action="sw-resize"></cropper-handle>',8)]),40,re)],64)):k("",!0)],44,ie),n("div",ce,[o(i)?(g(),h(A,{key:0},[t(r,{round:"",flat:"",icon:o(J),onClick:a[0]||(a[0]=s=>o(i).$zoom(.1))},null,8,["icon"]),t(r,{round:"",flat:"",icon:o(X),onClick:a[1]||(a[1]=s=>o(i).$zoom(-.1))},null,8,["icon"]),t(r,{round:"",flat:"",icon:o(G),onClick:a[2]||(a[2]=s=>o(i).$rotate("-45deg"))},null,8,["icon"]),t(r,{round:"",flat:"",icon:o(H),onClick:a[3]||(a[3]=s=>o(i).$rotate("45deg"))},null,8,["icon"]),t(r,{round:"",flat:"",icon:o(K),onClick:a[4]||(a[4]=s=>o(i).$scale(-1,1))},null,8,["icon"]),t(r,{round:"",flat:"",icon:o(M),onClick:a[5]||(a[5]=s=>o(i).$scale(1,-1))},null,8,["icon"])],64)):k("",!0)])]),n("div",de,[n("div",ue,[t(oe,{accept:".jpg,.png",multiple:!1,label:o(S)("base.chooseFile"),"show-preview":!1,onOnFileAdd:F},null,8,["label"]),n("div",pe,[Y(e.$slots,"preview",{},()=>[t(ne,{height:"470px"},{default:_(()=>[l.value?(g(),h("div",ve,[t(v,{src:l.value,style:{width:"100%","max-height":"320px"},ratio:e.ratio},null,8,["src","ratio"]),t(v,{src:l.value,style:{width:"160px","max-height":"160px"},ratio:e.ratio},null,8,["src","ratio"]),t(v,{src:l.value,style:{width:"80px","max-height":"80px"},ratio:e.ratio},null,8,["src","ratio"]),t(v,{src:l.value,style:{width:"40px","max-height":"40px"},ratio:e.ratio},null,8,["src","ratio"]),t(v,{src:l.value,style:{width:"20px","max-height":"20px"},ratio:e.ratio},null,8,["src","ratio"])])):k("",!0)]),_:1})])]),n("div",me,[t(r,{full:"",icon:o(ee),label:o(S)("base.okay"),loading:w.value,onClick:U},null,8,["icon","label","loading"])])])])]))}});export{Ce as _};
