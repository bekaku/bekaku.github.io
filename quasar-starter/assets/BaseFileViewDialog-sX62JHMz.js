import{F,f as p,c as V,d as P,e as x,h as I,i as M}from"./FileManagerService-CwRtvFJO.js";import{l as N,am as k,an as C,a as b,r as n,o as L,R as D,T as v,n as u,m as h}from"./index-D2_s7zbP.js";import{_ as E}from"./BasePdfViewDialog.vue_vue_type_script_setup_true_lang-DcRced_B.js";import T from"./BaseImageViewDialog-BNasvG5Y.js";import"./useAxios-DC4_ZzHn.js";import"./image-view-CLzyl5zW.js";import"./BaseFilesPreviewItem.vue_vue_type_script_setup_true_lang-BFzXtabG.js";import"./BaseAvatar-Dd0BukBT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseFilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-DSeLhmFA.js";import"./BaseScrollArea.vue_vue_type_script_setup_true_lang-Ce9av46d.js";import"./useAppMeta-Det3xs35.js";import"./use-meta-DhCLVLMg.js";import"./BasePage.vue_vue_type_script_setup_true_lang-wpeDAXDG.js";import"./BaseCard-DIxBFYod.js";import"./ClosePopup-2-dEFwXe.js";import"./BaseSwiperSlides.vue_vue_type_script_setup_true_lang-Bqf1JCrB.js";import"./index-CEed9t5C.js";import"./SkeletonItem.vue_vue_type_script_setup_true_lang-G2xTrWP4.js";import"./BaseButton-CvbVWVz2.js";const S={key:0},ae=N({__name:"BaseFileViewDialog",props:k({title:{},item:{},imageList:{},selectIndex:{},fetch:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},isBlob:{type:Boolean,default:!1}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(t){const w=C(t,"show"),{appLoading:d}=b(),{downloadCdnData:g}=F(),l=n(!1),o=n(void 0),m=n(),r=n([]),c=n(0);L(async()=>{if(d(),await B(),t.selectIndex!=null&&t.selectIndex>=0&&(c.value=t.selectIndex),o.value=="pdf"){if(t.item.file){const e=await p(t.item.file);e&&(m.value=e)}else m.value=t.item.filePath;l.value=!0}else o.value=="image"?(t.imageList&&t.imageList.length>0?r.value.push(...t.imageList):r.value.push(t.item),l.value=!0):(await y(),s());d(!1)});const y=async()=>{const e=t.item;if(!e||!e.filePath)return s(),new Promise(a=>a(!1));if(t.fetch)await g(e.filePath,e.fileName||t.title);else{const a=V(e.fileMime),i=P(a);if(a&&i)if(t.isBlob)try{x(e.filePath,e.fileName||i)}catch(f){console.error(f)}else try{I(e.filePath,e.fileName||i)}catch(f){console.error(f)}}return new Promise(a=>a(!0))},B=async()=>new Promise(e=>{t.item||s(),o.value=M(t.item.fileMime),e(!0)}),s=()=>{w.value=!1};return(e,a)=>e.item&&o.value?(u(),D("div",S,[l.value&&o.value=="pdf"&&m.value?(u(),h(E,{key:0,modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value=i),src:m.value,"fetch-to-server":e.fetch,title:e.item.fileName||e.title,onOnClose:s},null,8,["modelValue","src","fetch-to-server","title"])):o.value=="image"&&l.value?(u(),h(T,{key:1,modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),files:r.value,"selected-index":c.value,"show-delete-image":!1,maximized:!1,fetch:e.fetch,"show-arrow":e.showArrow,onOnClose:s},null,8,["modelValue","files","selected-index","fetch","show-arrow"])):v("",!0)])):v("",!0)}});export{ae as default};
