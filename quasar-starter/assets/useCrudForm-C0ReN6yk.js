import{l as J,be as K,u as z,bu as Z,c as E,m as h,n as P,aq as x,w as o,x as d,v as y,bv as _,a0 as N,a5 as s,bw as ee,a7 as ae,W as L,X as F,bx as te,V as ne,ah as se,av as ue,aA as O,bf as re,ay as ie,by as le,aI as oe,a as de,r as f,bz as ce,bA as H,bB as me,o as fe,C as l,s as B,d as M,e as ve,h as be,bC as Pe,J as ye}from"./index-BUKV_9O1.js";import{B as p}from"./BaseButton-CaTrqY0C.js";import{u as ge}from"./useAxios-578BH76m.js";const Be=J({__name:"CrudApiForm",props:{crudName:{},listPermission:{},managePermission:{},byPassPermission:{type:Boolean,default:!1},title:{},icon:{default:()=>K},loading:{type:Boolean,default:!1},showBack:{type:Boolean,default:!0},showDelete:{type:Boolean},showEdit:{type:Boolean},crudAction:{},showActionText:{type:Boolean,default:!0},fullWidth:{type:Boolean,default:!0},editButton:{type:Boolean,default:!0},deleteButton:{type:Boolean,default:!0},copyButton:{type:Boolean,default:!1},buttonSize:{default:"md"}},emits:["on-back","on-submit","on-delete"],setup(e){const{t:n}=z(),v=Z(),b=E(()=>e.byPassPermission?!0:e.managePermission?v.isHavePermission(e.managePermission):e.crudName?v.isHavePermission([`${e.crudName}_manage`]):!0),A=E(()=>e.byPassPermission?!0:e.listPermission?v.isHavePermission(e.listPermission):e.crudName?v.isHavePermission([`${e.crudName}_list`]):!0);return(a,u)=>(P(),h(x,{flat:"",bordered:"",class:"wee-container-responsive-center"},{default:o(()=>[d(O,null,{default:o(()=>[y(a.$slots,"crudFromToolbar",{},()=>[d(_,null,{default:o(()=>[A.value&&a.showBack?(P(),h(p,{key:0,onClick:u[0]||(u[0]=g=>a.$emit("on-back")),flat:"",round:"",icon:s(ee)},{default:o(()=>[d(ae,null,{default:o(()=>[L(F(s(n)("base.back")),1)]),_:1})]),_:1},8,["icon"])):N("",!0),d(te,null,{default:o(()=>[a.crudAction&&a.showActionText?(P(),ne(se,{key:0},[L(F(a.crudAction==="new"?s(n)("base.addNew"):a.crudAction==="view"?s(n)("base.edit"):s(n)("base.copy")),1)],64)):N("",!0),L(" "+F(a.title),1)]),_:1}),y(a.$slots,"toolbarAction",{},()=>[d(ue,{size:"md",name:a.icon},null,8,["name"])])]),_:3})])]),_:3}),y(a.$slots,"crudFrom",{},()=>[d(oe,{onSubmit:u[3]||(u[3]=g=>a.$emit("on-submit")),class:"q-gutter-md"},{default:o(()=>[y(a.$slots,"crudFromContent"),y(a.$slots,"crudAction",{},()=>[d(re),d(O,{align:"center",class:"q-gutter-sm"},{default:o(()=>[b.value&&a.showEdit?(P(),h(p,{key:0,unelevated:"",icon:s(ie),label:s(n)("base.save")+(a.crudAction==="view"?s(n)("base.edit"):""),type:"submit",loading:a.loading,color:"primary"},null,8,["icon","label","loading"])):N("",!0),a.crudAction==="view"&&b.value&&a.showDelete?(P(),h(p,{key:1,unelevated:"",icon:s(le),label:s(n)("base.delete"),color:"negative",loading:a.loading,onClick:u[1]||(u[1]=g=>a.$emit("on-delete"))},null,8,["icon","label","loading"])):N("",!0),A.value&&a.showBack?(P(),h(p,{key:2,label:s(n)("base.cancel"),onClick:u[2]||(u[2]=g=>a.$emit("on-back")),flat:"",class:"q-ml-sm",disable:a.loading},null,8,["label","disable"])):N("",!0),y(a.$slots,"additionalCrudAction")]),_:3})])]),_:3})])]),_:3}))}}),Ee=(e,n)=>{const{appNavigateTo:v,getParam:b,appToast:A,appConfirm:a,isDevMode:u,getPreviousPath:g}=de(),{callAxios:C}=ge(),{t:$}=z(),T=f(g()),k=f(!1),w=f(b(H)!=null?ce(b(H)):0),c=f(Object.assign({},n)),I=f(e.requestEntityName?e.requestEntityName:void 0),r=f(b(me)),D=f(e.fetchDataLink);fe(async()=>{e.fectchDataOnLoad&&V()});const V=async()=>r.value==l.VIEW||r.value==l.COPY?(await q(),r.value==l.COPY&&(c.value.id=null),new Promise(t=>{t(!0)})):new Promise(t=>{t(!0)}),R=E(()=>D.value?D.value:`${e.apiEndpoint}/${B(e.crudName?e.crudName:"")}/${w.value}`),q=async()=>{if(!w.value&&(!e.apiEndpoint||!e.crudName))return new Promise(m=>{m(!1)});k.value=!0;const t=R.value,i=await C({API:t,method:"GET"});return k.value=!1,!M(i)&&!ve(i)&&(c.value=i),new Promise(m=>{m(!0)})},Y=()=>{c.value=Object.assign({},n)},S=()=>{let t="";e.backToPreviousPath!=null&&e.backToPreviousPath&&(t=T.value);const i=e.basePath||Pe;t||(t=e.backLink?e.backLink:T.value?T.value:e.crudName?`${i?"/"+i:""}/${e.crudName.replaceAll("_","-")}`:""),t&&v(t)},j=E(()=>{if(!(!e.apiEndpoint||!e.crudName))return r.value===l.VIEW?e.actionPut?e.actionPut:e.apiEndpoint+"/"+B(e.crudName)+(e.methodPutIncludeId===void 0||e.methodPutIncludeId===!0?"/"+c.value.id:""):e.actionPost?e.actionPost:e.apiEndpoint+"/"+B(e.crudName)}),U=async()=>{if(!e.apiEndpoint||!e.crudName)return;const t={};t[I.value?I.value:`${B(e.crudName)}`]=c.value;const i=j.value;if(!i)return;u(),k.value=!0;const m=await C({API:i,method:r.value===l.VIEW?"PUT":"POST",body:t});if(k.value=!1,!M(m))return m&&m.id&&(r.value===l.NEW||r.value===l.COPY?Q($("success.insertSuccesfull")):r.value===l.VIEW&&Q($("success.updateSuccesfull"))),e.preventRedirectToList||S(),new Promise(G=>{G(!0)})},Q=t=>{A(t,{multiLine:!1,html:!0,type:"positive",timeout:3*1e3,position:"bottom",actions:[{icon:ye,color:"white"}]})},W=E(()=>e.actionDelete?e.actionDelete:e.apiEndpoint&&e.crudName?`${e.apiEndpoint}/${B(e.crudName)}/${w.value}`:""),X=async()=>{if(r.value!=l.VIEW&&!c.value&&w.value==0&&!W.value)return;await a($("app.monogram"),$("base.deleteConfirm"))&&(await C({API:W.value,method:"DELETE"}),S())};return be(()=>{Y()}),{loading:k,...{onBack:S,onSubmit:U,onDelete:X,fetchDataById:q,preFectData:V},crudId:w,crudAction:r,crudEntity:c,crudName:e.crudName,requestEntityName:I,fetchDataLink:D}};export{Be as _,Ee as u};
