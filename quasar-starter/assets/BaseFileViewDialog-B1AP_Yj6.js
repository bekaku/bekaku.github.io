import{F,f as V,c as p,d as P,e as x,h as I,i as M}from"./FileManagerService-BHSiTww-.js";import{l as N,ad as k,ae as C,a as b,r as n,o as L,V as D,a0 as v,n as u,m as h}from"./index-C7ops4Xx.js";import{_ as E}from"./BasePdfViewDialog.vue_vue_type_script_setup_true_lang-B-fOdu_j.js";import S from"./BaseImageViewDialog-DhCehoht.js";import"./useAxios-CqGq8IzB.js";import"./image-view-BzcCYoNT.js";import"./FilesPreviewItem.vue_vue_type_script_setup_true_lang-BlzwJRNG.js";import"./BaseAvatar-CiSapBuH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-CTkus_NJ.js";import"./BaseScrollArea.vue_vue_type_script_setup_true_lang-BjLt65EU.js";import"./useAppMeta-DajxZBiW.js";import"./use-meta-BoZp1IKx.js";import"./BasePage.vue_vue_type_script_setup_true_lang-D4SVBa1v.js";import"./BaseCard-J5Ngfw26.js";import"./ClosePopup-CLsto8Iq.js";import"./BaseSwiperSlides.vue_vue_type_script_setup_true_lang-CR4H1WkA.js";import"./index-DNJhbzqD.js";import"./SkeletonItem.vue_vue_type_script_setup_true_lang-D7RmRV_w.js";const T={key:0},te=N({__name:"BaseFileViewDialog",props:k({title:{},item:{},imageList:{},selectIndex:{},fetch:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},isBlob:{type:Boolean,default:!1}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(t){const w=C(t,"show"),{appLoading:d}=b(),{downloadCdnData:g}=F(),l=n(!1),o=n(void 0),m=n(),r=n([]),c=n(0);L(async()=>{if(d(),await B(),t.selectIndex!=null&&t.selectIndex>=0&&(c.value=t.selectIndex),o.value=="pdf"){if(t.item.file){const e=await V(t.item.file);e&&(m.value=e)}else m.value=t.item.filePath;l.value=!0}else o.value=="image"?(t.imageList&&t.imageList.length>0?r.value.push(...t.imageList):r.value.push(t.item),l.value=!0):(await y(),s());d(!1)});const y=async()=>{const e=t.item;if(!e||!e.filePath)return s(),new Promise(a=>a(!1));if(t.fetch)await g(e.filePath,e.fileName||t.title);else{const a=p(e.fileMime),i=P(a);if(a&&i)if(t.isBlob)try{x(e.filePath,e.fileName||i)}catch(f){console.error(f)}else try{I(e.filePath,e.fileName||i)}catch(f){console.error(f)}}return new Promise(a=>a(!0))},B=async()=>new Promise(e=>{t.item||s(),o.value=M(t.item.fileMime),e(!0)}),s=()=>{w.value=!1};return(e,a)=>e.item&&o.value?(u(),D("div",T,[l.value&&o.value=="pdf"&&m.value?(u(),h(E,{key:0,modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value=i),src:m.value,"fetch-to-server":e.fetch,title:e.item.fileName||e.title,onOnClose:s},null,8,["modelValue","src","fetch-to-server","title"])):o.value=="image"&&l.value?(u(),h(S,{key:1,modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),files:r.value,"selected-index":c.value,"show-delete-image":!1,maximized:!1,fetch:e.fetch,"show-arrow":e.showArrow,onOnClose:s},null,8,["modelValue","files","selected-index","fetch","show-arrow"])):v("",!0)])):v("",!0)}});export{te as default};
