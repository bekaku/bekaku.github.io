import{d as V,R as m,F as y,o as r,S as z,T as B,U as j,e as d,c as $,ab as b,cL as U,u as D,j as E,ac as k,k as P,b0 as H,n as O,g as q,a as I,r as Q,K as S,H as K,w as Z,dj as G,dk as J,cj as W,ci as X,dl as Y,dm as _,dn as x}from"./index-UTJsbmGU.js";import{n as ee,a as le,z as ae}from"./FileManagerService-oa2a8H9O.js";import{B as ie}from"./BaseButton-BUn1xyHV.js";import{_ as te}from"./FilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-WUe7Zivf.js";import{_ as se}from"./FilesPreviewItem.vue_vue_type_script_setup_true_lang-CW1ORnM-.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"row"},re={key:1,class:"col"},me=V({__name:"BaseFilesPreview",props:{showDelete:{type:Boolean,default:!0},col:{default:"col-3 q-pa-md"},items:{},formatSize:{type:Boolean},gallery:{type:Boolean,default:!0},imageSize:{}},emits:["on-remove"],setup(n,{emit:c}){const f=c,u=a=>{f("on-remove",a)};return(a,t)=>a.items.length>0?(r(),m("div",ne,[a.gallery?(r(!0),m(z,{key:0},B(a.items,(s,o)=>(r(),m("div",{key:`f-${o}-${s.fileName}`,class:j([a.col,"div-style q-pa-md"])},[d(se,{item:s,index:o,"show-delete":a.showDelete,"format-size":a.formatSize||!1,onOnRemove:u},null,8,["item","index","show-delete","format-size"])],2))),128)):(r(),m("div",re,[(r(!0),m(z,null,B(a.items,(s,o)=>(r(),$(te,{key:`f-alt-${o}-${s.fileName}`,item:s,index:o,dense:"","show-delete":a.showDelete,"format-size":a.formatSize||!1,"image-size":a.imageSize||"",onOnRemove:u},null,8,["item","index","show-delete","format-size","image-size"]))),128))]))])):y("",!0)}}),ue={key:0,class:"row"},de={class:"col-12 div-preview"},ce=V({__name:"BaseFilePicker",props:b({multiple:{type:Boolean,default:!0},showPreview:{type:Boolean,default:!0},gallery:{type:Boolean,default:!1},icon:{default:()=>X},label:{},accept:{default:()=>W},wildcard:{type:Boolean},maxFiles:{default:()=>J},previewHieight:{default:"250px"}},{modelValue:{default:()=>[]},modelModifiers:{},fileItems:{default:()=>[]},fileItemsModifiers:{}}),emits:b(["on-file-add"],["update:modelValue","update:fileItems"]),setup(n,{expose:c,emit:f}){U(e=>({acb71704:e.previewHieight}));const{appToast:u}=D(),{t:a}=E(),t=k(n,"modelValue"),s=k(n,"fileItems"),o=P([]),R=f,p=P(),F=()=>{if(n.multiple&&n.maxFiles>0&&t.value&&t.value.length==n.maxFiles){u(a("error.limitFile2",{total:n.maxFiles}),{type:"negative"});return}p.value&&p.value.$el.click()},g=()=>{t.value=[],o.value=[],s.value=[]},A=e=>{u(a("error.filesValidationFmt",{total:e.length}),{type:"negative"})},L=async e=>{const i=[];for(const l of e){const v=l.type;if(l.size>Y)u(a("error.limitEachFile2",[l.name,_]),{multiLine:!1,type:"negative"});else if(x.includes(v))i.push(l);else{const w=await ae(l);w&&i.push(w)}}return new Promise(l=>{l(i)})},N=async e=>{const i=Array.isArray(e)?e:[e],l=await L(i);if(R("on-file-add",l),n.multiple){if(l&&l.length>0)for(const v of l)await h(v)}else l&&(t.value=[],s.value=[],await h(l[0]));o.value=[]},h=async e=>{const i=ee(e);let l;i&&(l=await le(e)),C(e,i,l)},C=(e,i,l=void 0)=>{t.value&&(t.value.push(e),s.value.push({id:0,fileMime:e.type,fileName:e.name,filePath:l||"",fileThumbnailPath:"",fileSize:e.size+"",functionId:0,isImage:i,file:e}))},M=e=>{!t.value||t.value.length==0||(n.multiple?T(e):g())},T=e=>{t.value=t.value.filter((i,l)=>l!=e),s.value=s.value.filter((i,l)=>l!=e),o.value=o.value.filter((i,l)=>l!=e)};return H(()=>{g()}),c({openFilePicker:F}),(e,i)=>(r(),m("div",O(q(e.$attrs)),[I("div",{class:"cursor-pointer div",onClick:F},[Q(e.$slots,"default",{},()=>[d(ie,{icon:e.icon,outline:"",label:e.label?e.label:S(a)("base.chooseFile")},null,8,["icon","label"])],!0)]),d(K,null,{default:Z(()=>[e.showPreview?(r(),m("div",ue,[I("div",de,[s.value.length>0&&t.value&&t.value.length>0?(r(),$(me,{key:0,gallery:e.gallery,items:s.value,"format-size":"",onOnRemove:M},null,8,["gallery","items"])):y("",!0)])])):y("",!0)]),_:1}),d(G,{ref_key:"appFileInputRef",ref:p,modelValue:o.value,"onUpdate:modelValue":[i[0]||(i[0]=l=>o.value=l),N],style:{display:"none"},filled:"","max-files":e.maxFiles,"bottom-slots":"",label:e.label?e.label:S(a)("base.chooseFile"),counter:"",multiple:e.multiple,accept:e.wildcard?void 0:e.accept,onRejected:A},null,8,["modelValue","max-files","label","multiple","accept"])],16))}}),we=oe(ce,[["__scopeId","data-v-07baed74"]]);export{we as B,me as _};
