import{l as S,V as m,a0 as y,n as r,ah as z,aZ as B,Z as D,x as d,m as $,ad as k,d1 as E,a as U,u as q,ae as b,r as P,h as O,p as Z,q as j,t as V,v as H,a5 as I,a2 as Q,w as G,dR as J,dS as K,cE as W,cD as X,dT as Y,dU as _,dV as x}from"./index-__cRNkUR.js";import{j as ee,a as le,z as ae}from"./FileManagerService-DuFwoC8x.js";import{B as ie}from"./BaseButton-DlZR7aHG.js";import{_ as te}from"./FilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-BKr90zVv.js";import{_ as se}from"./FilesPreviewItem.vue_vue_type_script_setup_true_lang-DGj8l3z3.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"row"},re={key:1,class:"col"},me=S({__name:"BaseFilesPreview",props:{showDelete:{type:Boolean,default:!0},col:{default:"col-3 q-pa-md"},items:{},formatSize:{type:Boolean},gallery:{type:Boolean,default:!0},imageSize:{}},emits:["on-remove"],setup(n,{emit:f}){const c=f,u=a=>{c("on-remove",a)};return(a,t)=>a.items.length>0?(r(),m("div",ne,[a.gallery?(r(!0),m(z,{key:0},B(a.items,(s,o)=>(r(),m("div",{key:`f-${o}-${s.fileName}`,class:D([a.col,"div-style q-pa-md"])},[d(se,{item:s,index:o,"show-delete":a.showDelete,"format-size":a.formatSize||!1,onOnRemove:u},null,8,["item","index","show-delete","format-size"])],2))),128)):(r(),m("div",re,[(r(!0),m(z,null,B(a.items,(s,o)=>(r(),$(te,{key:`f-alt-${o}-${s.fileName}`,item:s,index:o,dense:"","show-delete":a.showDelete,"format-size":a.formatSize||!1,"image-size":a.imageSize||"",onOnRemove:u},null,8,["item","index","show-delete","format-size","image-size"]))),128))]))])):y("",!0)}}),ue={key:0,class:"row"},de={class:"col-12 div-preview"},fe=S({__name:"BaseFilePicker",props:k({multiple:{type:Boolean,default:!0},showPreview:{type:Boolean,default:!0},gallery:{type:Boolean,default:!1},icon:{default:()=>X},label:{},accept:{default:()=>W},wildcard:{type:Boolean},maxFiles:{default:()=>K},previewHieight:{default:"250px"}},{modelValue:{default:()=>[]},modelModifiers:{},fileItems:{default:()=>[]},fileItemsModifiers:{}}),emits:k(["on-file-add"],["update:modelValue","update:fileItems"]),setup(n,{expose:f,emit:c}){E(e=>({ec624e68:e.previewHieight}));const{appToast:u}=U(),{t:a}=q(),t=b(n,"modelValue"),s=b(n,"fileItems"),o=P([]),R=c,p=P(),h=()=>{if(n.multiple&&n.maxFiles>0&&t.value&&t.value.length==n.maxFiles){u(a("error.limitFile2",{total:n.maxFiles}),{type:"negative"});return}p.value&&p.value.$el.click()},F=()=>{t.value=[],o.value=[],s.value=[]},A=e=>{u(a("error.filesValidationFmt",{total:e.length}),{type:"negative"})},N=async e=>{const i=[];for(const l of e){const v=l.type;if(l.size>Y)u(a("error.limitEachFile2",[l.name,_]),{multiLine:!1,type:"negative"});else if(x.includes(v))i.push(l);else{const w=await ae(l);w&&i.push(w)}}return new Promise(l=>{l(i)})},C=async e=>{const i=Array.isArray(e)?e:[e],l=await N(i);if(R("on-file-add",l),n.multiple){if(l&&l.length>0)for(const v of l)await g(v)}else l&&(t.value=[],s.value=[],await g(l[0]));o.value=[]},g=async e=>{const i=ee(e);let l;i&&(l=await le(e)),L(e,i,l)},L=(e,i,l=void 0)=>{t.value&&(t.value.push(e),s.value.push({id:0,fileMime:e.type,fileName:e.name,filePath:l||"",fileThumbnailPath:"",fileSize:e.size+"",functionId:0,isImage:i,file:e}))},M=e=>{!t.value||t.value.length==0||(n.multiple?T(e):F())},T=e=>{t.value=t.value.filter((i,l)=>l!=e),s.value=s.value.filter((i,l)=>l!=e),o.value=o.value.filter((i,l)=>l!=e)};return O(()=>{F()}),f({openFilePicker:h}),(e,i)=>(r(),m("div",Z(j(e.$attrs)),[V("div",{class:"cursor-pointer div",onClick:h},[H(e.$slots,"default",{},()=>[d(ie,{icon:e.icon,outline:"",label:e.label?e.label:I(a)("base.chooseFile")},null,8,["icon","label"])],!0)]),d(Q,null,{default:G(()=>[e.showPreview?(r(),m("div",ue,[V("div",de,[s.value.length>0&&t.value&&t.value.length>0?(r(),$(me,{key:0,gallery:e.gallery,items:s.value,"format-size":"",onOnRemove:M},null,8,["gallery","items"])):y("",!0)])])):y("",!0)]),_:1}),d(J,{ref_key:"appFileInputRef",ref:p,modelValue:o.value,"onUpdate:modelValue":[i[0]||(i[0]=l=>o.value=l),C],style:{display:"none"},filled:"","max-files":e.maxFiles,"bottom-slots":"",label:e.label?e.label:I(a)("base.chooseFile"),counter:"",multiple:e.multiple,accept:e.wildcard?void 0:e.accept,onRejected:A},null,8,["modelValue","max-files","label","multiple","accept"])],16))}}),we=oe(fe,[["__scopeId","data-v-081490b0"]]);export{we as B,me as _};
