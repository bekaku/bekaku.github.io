import{F,f as p,c as V,d as P,e as x,h as I,i as M}from"./FileManagerService-CDT2qW08.js";import{l as N,aa as b,ab as k,a as C,r as n,o as L,ac as D,X as v,n as u,m as h}from"./index-BGAGrt6k.js";import{_ as E}from"./BasePdfViewDialog.vue_vue_type_script_setup_true_lang-s8J-mJXa.js";import S from"./BaseImageViewDialog-D_MCgpn_.js";import"./useAxios-BZ55Spu7.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./image-view-C-OxEsPe.js";import"./FilesPreviewItem.vue_vue_type_script_setup_true_lang-D6-xWUdZ.js";import"./BaseAvatar-BRZCl687.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-Bsd1dxaS.js";import"./BaseScrollArea.vue_vue_type_script_setup_true_lang-DQEy7ZMm.js";import"./useAppMeta-rQoohAA6.js";import"./use-meta-Bv9DsYp2.js";import"./BasePage.vue_vue_type_script_setup_true_lang-x40xV3gD.js";import"./BaseCard-BWQ5CqGY.js";import"./ClosePopup-B9FW-W_Z.js";import"./BaseSwiperSlides.vue_vue_type_script_setup_true_lang-Bni-WNGn.js";import"./index-DVzJpkTw.js";import"./SkeletonItem.vue_vue_type_script_setup_true_lang-6RYrUQ4d.js";const T={key:0},ae=N({__name:"BaseFileViewDialog",props:b({title:{},item:{},imageList:{},selectIndex:{},fetch:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},isBlob:{type:Boolean,default:!1}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(t){const w=k(t,"show"),{appLoading:d}=C(),{downloadCdnData:g}=F(),l=n(!1),o=n(void 0),m=n(),r=n([]),c=n(0);L(async()=>{if(d(),await B(),t.selectIndex!=null&&t.selectIndex>=0&&(c.value=t.selectIndex),o.value=="pdf"){if(t.item.file){const e=await p(t.item.file);e&&(m.value=e)}else m.value=t.item.filePath;l.value=!0}else o.value=="image"?(t.imageList&&t.imageList.length>0?r.value.push(...t.imageList):r.value.push(t.item),l.value=!0):(await y(),s());d(!1)});const y=async()=>{const e=t.item;if(!e||!e.filePath)return s(),new Promise(a=>a(!1));if(t.fetch)await g(e.filePath,e.fileName||t.title);else{const a=V(e.fileMime),i=P(a);if(a&&i)if(t.isBlob)try{x(e.filePath,e.fileName||i)}catch(f){console.error(f)}else try{I(e.filePath,e.fileName||i)}catch(f){console.error(f)}}return new Promise(a=>a(!0))},B=async()=>new Promise(e=>{t.item||s(),o.value=M(t.item.fileMime),e(!0)}),s=()=>{w.value=!1};return(e,a)=>e.item&&o.value?(u(),D("div",T,[l.value&&o.value=="pdf"&&m.value?(u(),h(E,{key:0,modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value=i),src:m.value,"fetch-to-server":e.fetch,title:e.item.fileName||e.title,onOnClose:s},null,8,["modelValue","src","fetch-to-server","title"])):o.value=="image"&&l.value?(u(),h(S,{key:1,modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),files:r.value,"selected-index":c.value,"show-delete-image":!1,maximized:!1,fetch:e.fetch,"show-arrow":e.showArrow,onOnClose:s},null,8,["modelValue","files","selected-index","fetch","show-arrow"])):v("",!0)])):v("",!0)}});export{ae as default};
