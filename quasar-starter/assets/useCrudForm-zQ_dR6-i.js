import{l as X,be as K,u as z,bt as Z,c as E,m as B,n as P,ar as x,w as o,x as d,v as y,bu as _,a3 as N,J as s,bv as ee,Q as ae,L as S,M as F,bw as te,$ as ne,ai as se,aw as ue,aB as W,bf as re,az as ie,bx as le,aJ as oe,a as de,r as f,by as ce,bz as H,bA as me,o as fe,C as l,s as h,d as M,e as ve,h as be,bB as Pe,R as ye}from"./index-NsS699ic.js";import{B as p}from"./BaseButton-CNa-6ezi.js";import{u as ge}from"./useAxios-DXOj_sxf.js";const he=X({__name:"CrudApiForm",props:{crudName:{},listPermission:{},managePermission:{},byPassPermission:{type:Boolean,default:!1},title:{},icon:{default:()=>K},loading:{type:Boolean,default:!1},showBack:{type:Boolean,default:!0},showDelete:{type:Boolean},showEdit:{type:Boolean},crudAction:{},showActionText:{type:Boolean,default:!0},fullWidth:{type:Boolean,default:!0},editButton:{type:Boolean,default:!0},deleteButton:{type:Boolean,default:!0},copyButton:{type:Boolean,default:!1},buttonSize:{default:"md"}},emits:["on-back","on-submit","on-delete"],setup(e){const{t:n}=z(),v=Z(),b=E(()=>e.byPassPermission?!0:e.managePermission?v.isHavePermission(e.managePermission):e.crudName?v.isHavePermission([`${e.crudName}_manage`]):!0),A=E(()=>e.byPassPermission?!0:e.listPermission?v.isHavePermission(e.listPermission):e.crudName?v.isHavePermission([`${e.crudName}_list`]):!0);return(a,u)=>(P(),B(x,{flat:"",bordered:"",class:"wee-container-responsive-center"},{default:o(()=>[d(W,null,{default:o(()=>[y(a.$slots,"crudFromToolbar",{},()=>[d(_,null,{default:o(()=>[A.value&&a.showBack?(P(),B(p,{key:0,onClick:u[0]||(u[0]=g=>a.$emit("on-back")),flat:"",round:"",icon:s(ee)},{default:o(()=>[d(ae,null,{default:o(()=>[S(F(s(n)("base.back")),1)]),_:1})]),_:1},8,["icon"])):N("",!0),d(te,null,{default:o(()=>[a.crudAction&&a.showActionText?(P(),ne(se,{key:0},[S(F(a.crudAction==="new"?s(n)("base.addNew"):a.crudAction==="view"?s(n)("base.edit"):s(n)("base.copy")),1)],64)):N("",!0),S(" "+F(a.title),1)]),_:1}),y(a.$slots,"toolbarAction",{},()=>[d(ue,{size:"md",name:a.icon},null,8,["name"])])]),_:3})])]),_:3}),y(a.$slots,"crudFrom",{},()=>[d(oe,{onSubmit:u[3]||(u[3]=g=>a.$emit("on-submit")),class:"q-gutter-md"},{default:o(()=>[y(a.$slots,"crudFromContent"),y(a.$slots,"crudAction",{},()=>[d(re),d(W,{align:"center",class:"q-gutter-sm"},{default:o(()=>[b.value&&a.showEdit?(P(),B(p,{key:0,unelevated:"",icon:s(ie),label:s(n)("base.save")+(a.crudAction==="view"?s(n)("base.edit"):""),type:"submit",loading:a.loading,color:"primary"},null,8,["icon","label","loading"])):N("",!0),a.crudAction==="view"&&b.value&&a.showDelete?(P(),B(p,{key:1,unelevated:"",icon:s(le),label:s(n)("base.delete"),color:"negative",loading:a.loading,onClick:u[1]||(u[1]=g=>a.$emit("on-delete"))},null,8,["icon","label","loading"])):N("",!0),A.value&&a.showBack?(P(),B(p,{key:2,label:s(n)("base.cancel"),onClick:u[2]||(u[2]=g=>a.$emit("on-back")),flat:"",class:"q-ml-sm",disable:a.loading},null,8,["label","disable"])):N("",!0),y(a.$slots,"additionalCrudAction")]),_:3})])]),_:3})])]),_:3}))}}),Ee=(e,n)=>{const{appNavigateTo:v,getParam:b,appToast:A,appConfirm:a,isDevMode:u,getPreviousPath:g}=de(),{callAxios:T}=ge(),{t:$}=z(),C=f(g()),k=f(!1),w=f(b(H)!=null?ce(b(H)):0),c=f(Object.assign({},n)),I=f(e.requestEntityName?e.requestEntityName:void 0),r=f(b(me)),D=f(e.fetchDataLink);fe(async()=>{e.fectchDataOnLoad&&Q()});const Q=async()=>r.value==l.VIEW||r.value==l.COPY?(await V(),r.value==l.COPY&&(c.value.id=null),new Promise(t=>{t(!0)})):new Promise(t=>{t(!0)}),R=E(()=>D.value?D.value:`${e.apiEndpoint}/${h(e.crudName?e.crudName:"")}/${w.value}`),V=async()=>{if(!w.value&&(!e.apiEndpoint||!e.crudName))return new Promise(m=>{m(!1)});k.value=!0;const t=R.value,i=await T({API:t,method:"GET"});return k.value=!1,!M(i)&&!ve(i)&&(c.value=i),new Promise(m=>{m(!0)})},Y=()=>{c.value=Object.assign({},n)},L=()=>{let t="";e.backToPreviousPath!=null&&e.backToPreviousPath&&(t=C.value);const i=e.basePath||Pe;t||(t=e.backLink?e.backLink:C.value?C.value:e.crudName?`${i?"/"+i:""}/${e.crudName.replaceAll("_","-")}`:""),t&&v(t)},j=E(()=>{if(!(!e.apiEndpoint||!e.crudName))return r.value===l.VIEW?e.actionPut?e.actionPut:e.apiEndpoint+"/"+h(e.crudName)+(e.methodPutIncludeId===void 0||e.methodPutIncludeId===!0?"/"+c.value.id:""):e.actionPost?e.actionPost:e.apiEndpoint+"/"+h(e.crudName)}),J=async()=>{if(!e.apiEndpoint||!e.crudName)return;const t={};t[I.value?I.value:`${h(e.crudName)}`]=c.value;const i=j.value;if(!i)return;u(),k.value=!0;const m=await T({API:i,method:r.value===l.VIEW?"PUT":"POST",body:t});if(k.value=!1,!M(m))return m&&m.id&&(r.value===l.NEW||r.value===l.COPY?q($("success.insertSuccesfull")):r.value===l.VIEW&&q($("success.updateSuccesfull"))),e.preventRedirectToList||L(),new Promise(G=>{G(!0)})},q=t=>{A(t,{multiLine:!1,html:!0,type:"positive",timeout:3*1e3,position:"bottom",actions:[{icon:ye,color:"white"}]})},O=E(()=>e.actionDelete?e.actionDelete:e.apiEndpoint&&e.crudName?`${e.apiEndpoint}/${h(e.crudName)}/${w.value}`:""),U=async()=>{if(r.value!=l.VIEW&&!c.value&&w.value==0&&!O.value)return;await a($("app.monogram"),$("base.deleteConfirm"))&&(await T({API:O.value,method:"DELETE"}),L())};return be(()=>{Y()}),{loading:k,...{onBack:L,onSubmit:J,onDelete:U,fetchDataById:V,preFectData:Q},crudId:w,crudAction:r,crudEntity:c,crudName:e.crudName,requestEntityName:I,fetchDataLink:D}};export{he as _,Ee as u};
