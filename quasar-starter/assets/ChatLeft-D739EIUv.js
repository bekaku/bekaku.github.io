import{l as w,a as F,c as B,e3 as ae,m as u,n as i,a2 as se,w as a,t as G,Y as q,u as W,b7 as ie,a0 as k,as as le,x as l,at as $,au as L,W as f,av as C,a5 as o,dB as oe,X as v,c7 as ne,V as N,dD as re,dG as z,ah as S,v as x,dS as ue,bq as ce,a7 as me,Z as de,r as g,f7 as pe,y as fe,bt as he,o as ge,M as ve,bv as ye,bx as be,J as ke,cT as Ce,aA as Ie,bk as Te,bg as A,aZ as E,f8 as O,bM as Ne}from"./index-BUKV_9O1.js";import{C as Se}from"./ClosePopup-DPKYBDjj.js";import{_ as _e,u as Le}from"./index-CbiDICnp.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B as D}from"./BaseButton-CaTrqY0C.js";import{B as we}from"./BaseCard-CVr34Mor.js";import{_ as Me}from"./BaseDropdownMenu.vue_vue_type_script_setup_true_lang-ClCoKzA0.js";import{_ as $e}from"./BaseInput.vue_vue_type_script_setup_true_lang-DONewUfx.js";import{_ as P}from"./BaseResult.vue_vue_type_script_setup_true_lang-YQvm5QEs.js";import{_ as V}from"./BaseScrollArea.vue_vue_type_script_setup_true_lang-CGGch_uA.js";import{B as Ae}from"./BaseTabs-D0Qt7Ow4.js";import"./BaseAvatar-YhefbKXS.js";import"./FileManagerService-DtMSDvzq.js";import"./useAxios-578BH76m.js";import"./QChatMessage-DaItF_9Y.js";import"./ContentItem-DATjPqDu.js";import"./OpenGraphItemAlt.vue_vue_type_script_setup_true_lang-7wY7Jhna.js";import"./BaseRippleItem.vue_vue_type_script_setup_true_lang-B0a1Gwy1.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-DQBFuEsj.js";import"./useAppMeta-eA7SJycm.js";import"./use-meta-BfsM_rxZ.js";import"./BaseSpinner-Cd9dyqoV.js";import"./SkeletonItem.vue_vue_type_script_setup_true_lang-C9i1fiUb.js";import"./BaseLabelValueItem.vue_vue_type_script_setup_true_lang-C6tqZTAA.js";const Ee=["innerHTML"],Oe=w({__name:"BaseContentHtml",props:{content:{},isEscapeHtml:{type:Boolean,default:!1},highLightText:{}},emits:["on-press"],setup(m,{emit:h}){const{inputSanitizeHtml:n}=F(),d=h,y=t=>{d("on-press",t)},b=B(()=>{if(!m.content)return"";const t=m.isEscapeHtml?n(ae(m.content)):n(m.content);return m.highLightText?t.replaceAll(m.highLightText,`<span class='text-weight-bold text-blue'>${m.highLightText}</span>`):t});return(t,c)=>(i(),u(se,null,{default:a(()=>[G("div",q(t.$attrs,{onClick:c[0]||(c[0]=I=>y(I)),innerHTML:b.value}),null,16,Ee)]),_:1}))}}),Pe={class:"row"},Ve=w({__name:"ChatHistoryItem",props:{item:{},avatarSize:{},isActive:{type:Boolean,default:!1},dense:{type:Boolean,default:!1},closePopup:{type:Boolean},showSettingIcon:{type:Boolean,default:!0},clickable:{type:Boolean,default:!0}},emits:["on-item-click"],setup(m,{emit:h}){const n=h,{appFormatDateAuto:d}=F(),{t:y}=W(),b=()=>{n("on-item-click",m.item)};return(t,c)=>t.item?ie((i(),u(le,q({key:0},t.$attrs,{dense:t.dense,clickable:t.clickable,onClick:b,class:{"active-chat":t.isActive}}),{default:a(()=>[l($,{avatar:""},{default:a(()=>[l(_e,{item:t.item},null,8,["item"])]),_:1}),l($,null,{default:a(()=>[l(L,{lines:"1"},{default:a(()=>[t.item.favorite&&t.showSettingIcon?(i(),u(C,{key:0,color:"amber-8",size:"11px",class:"q-mb-xs",name:o(oe)},null,8,["name"])):k("",!0),f(" "+v(`${t.item.chatType=="GROUP"?"("+o(ne)(t.item.totalMembers)+") ":""}${t.item.groupName?t.item.groupName:o(y)("chats.groupUntitledName")}`),1)]),_:1}),l(L,{caption:"",lines:"1"},{default:a(()=>[G("div",Pe,[t.item.muteNotify&&t.showSettingIcon?(i(),u(C,{key:0,size:"15px",class:"text-muted",name:o(re)},null,8,["name"])):k("",!0),t.item.latestMessageType!="LOCATION"&&t.item.latestMessage?(i(),u(Oe,{key:1,content:t.item.latestMessage,"is-escape-html":""},null,8,["content"])):o(z)(t.item.latestMessageType)!=""?(i(),N(S,{key:2},[f(v(o(y)(o(z)(t.item.latestMessageType))),1)],64)):(i(),N(S,{key:3},[f(" Â  ")],64))])]),_:1})]),_:1}),l($,{side:""},{default:a(()=>[x(t.$slots,"side",{},()=>[t.item.latestUpdate?(i(),u(L,{key:0,caption:"",lines:"1"},{default:a(()=>[f(v(o(d)(t.item.latestUpdate)),1)]),_:1})):k("",!0),!t.isActive&&t.item.totalNewMessage>0?(i(),u(L,{key:1,caption:""},{default:a(()=>[l(ue,{color:"negative"},{default:a(()=>[f(v(t.item.totalNewMessage>=100?"99+":t.item.totalNewMessage),1)]),_:1})]),_:1})):k("",!0)],!0)]),_:3})]),_:3},16,["dense","clickable","class"])),[[Se]]):k("",!0)}}),H=Be(Ve,[["__scopeId","data-v-04a4557d"]]),He=w({__name:"BaseTooltip",props:{color:{},label:{}},setup(m){const{isDark:h}=ce();return(n,d)=>(i(),u(me,{class:de(`bg-${n.color||(o(h)?"white text-black":"black")}`)},{default:a(()=>[x(n.$slots,"default",{},()=>[f(v(n.label),1)])]),_:3},8,["class"]))}}),rt=w({__name:"ChatLeft",props:{groupItem:{},height:{},showClose:{type:Boolean,default:!1},autoDetect:{type:Boolean,default:!0}},emits:["on-item-click","on-close"],setup(m,{emit:h}){const{t:n}=W(),d=Le(),y=h,b=g("ALL"),t=g([{label:n("chats.all"),value:"ALL"},{label:n("chats.groups"),value:"GROUP"},{label:n("chats.favorite"),value:"FAVORITE"}]),c=g([...pe.dataList]),I=g();g(!1),g("PERSONAL");const X=g([{label:n("chats.addNewprivateChat"),icon:fe,value:"PERSONAL"},{label:n("chats.groupChatCreate"),icon:he,value:"GROUP"}]);ge(async()=>{m.autoDetect&&Z()});const T=B(()=>{const e=I.value?.toString().trim();return e?c.value.filter(s=>s.groupName&&s.groupName.toLowerCase().includes(e.toLowerCase())):c.value}),Y=B(()=>T.value.filter(e=>e.chatType=="GROUP")),U=B(()=>T.value.filter(e=>e.favorite)),Z=()=>{if(c.value&&c.value.length>0){const e=c.value[0];e&&_(e)}},J=e=>{console.log("onMenuClick",e)},_=e=>{y("on-item-click",e)},j=e=>{console.log("onUpdatesearch",e)},R=e=>c.value.findIndex(s=>s.id==e),M=e=>c.value[e],K=async()=>{const e=await Ne(c.value,"pin","desc");c.value=e},ee=e=>{e!=null&&e>=0&&M(e)&&c.value.splice(e,1)},Q=async(e,s=!0)=>{if(e){const r=R(e);if(r>=0){const p=M(r);p&&p.id&&(p.totalNewMessage=0)}}},te=()=>{if(!d?.chatId||!d?.chatSettingType){d.clearSetting();return}const e=R(d.chatId);if(e>=0){const s=M(e);if(s)switch(d.chatSettingType){case"NOTIFICATION":s.muteNotify=!s.muteNotify;break;case"PIN":s.pin=!s.pin,K();break;case"FAVORITE":s.favorite=!s.favorite;break;case"LEAVE":ee(e);break;case"CLEAR_NEW_MESSAGE_NUMBER":s.totalNewMessage>0&&s.id&&Q(s.id,!0);break;case"CLEAR_NEW_MESSAGE_NUMBER_ONLY":s.id&&Q(s.id,!1);break}}d.clearSetting()};return ve(d,e=>{e.toggleChatSetting&&te()}),(e,s)=>(i(),u(we,{flat:"",bordered:!1},{default:a(()=>[l(ye,null,{default:a(()=>[l(be,{class:"text-weight-bold"},{default:a(()=>[f(v(o(n)("chats.chats")),1)]),_:1}),e.showClose?(i(),u(D,{key:0,flat:"",round:"",icon:o(ke),onClick:s[0]||(s[0]=r=>e.$emit("on-close"))},null,8,["icon"])):k("",!0),l(D,{flat:"",round:"",icon:o(Ce)},{default:a(()=>[l(Me,{items:X.value,onOnClick:J},null,8,["items"]),l(He,null,{default:a(()=>[f(v(o(n)("chats.addNewChat")),1)]),_:1})]),_:1},8,["icon"])]),_:1}),l(Ie,null,{default:a(()=>[l($e,{modelValue:I.value,"onUpdate:modelValue":[s[1]||(s[1]=r=>I.value=r),j],label:o(n)("base.search"),debounce:250},{prepend:a(()=>[l(C,{name:o(Te)},null,8,["name"])]),_:1},8,["modelValue","label"])]),_:1}),l(Ae,{modelValue:b.value,"onUpdate:modelValue":s[2]||(s[2]=r=>b.value=r),items:t.value,"use-tab-panels":"","keep-alive":"",animated:!1,class:"q-ml-xs"},{ALL:a(()=>[T.value.length>0?(i(),u(A,{key:0},{default:a(()=>[l(V,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,E(T.value,(r,p)=>(i(),u(H,{key:`all-${r.id}-${p}`,item:r,"is-active":e.groupItem?.id==r.id,onOnItemClick:_},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),u(P,{key:1,status:"empty",description:o(n)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[l(C,{name:o(O),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),GROUP:a(()=>[T.value.length>0?(i(),u(A,{key:0},{default:a(()=>[l(V,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,E(Y.value,(r,p)=>(i(),u(H,{key:`group-${r.id}-${p}`,item:r,"is-active":e.groupItem?.id==r.id,onOnItemClick:_},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),u(P,{key:1,status:"empty",description:o(n)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[l(C,{name:o(O),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),FAVORITE:a(()=>[U.value.length>0?(i(),u(A,{key:0},{default:a(()=>[l(V,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,E(U.value,(r,p)=>(i(),u(H,{key:`fav-${r.id}-${p}`,item:r,"is-active":e.groupItem?.id==r.id,onOnItemClick:_},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),u(P,{key:1,status:"empty",description:o(n)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[l(C,{name:o(O),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),_:1},8,["modelValue","items"])]),_:1}))}});export{rt as default};
