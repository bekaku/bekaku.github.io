import{ap as Le,cL as Ye,cM as ke,cN as ze,aq as Ue,ar as We,as as Xe,cO as Ee,cP as Je,r as B,c,cQ as W,cR as C,cS as Ze,a2 as ye,cr as Ge,cT as Re,cU as el,cV as ll,au as tl,at as s,cW as ul,cX as nl,cY as al,b7 as Me,ae as ie,l as ol,al as ge,am as il,u as sl,m as X,n as E,bN as rl,w as q,t as oe,M as be,J as x,T as _e,c8 as dl,x as J,c7 as cl,cZ as qe,c6 as vl,az as ml}from"./index-D_pQv8pS.js";import{C as fl}from"./ClosePopup-DKr1Zozv.js";import{B as hl}from"./BaseButton-Dqt7G8pG.js";import{_ as kl}from"./BaseInput.vue_vue_type_script_setup_true_lang-CMjKUqvY.js";function yl(t,O){return t.hour!==null&&t.minute===null?"minute":"hour"}function gl(){const t=new Date;return{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()}}const bl=Le({name:"QTime",props:{...Ue,...ze,...ke,modelValue:{required:!0,validator:t=>typeof t=="string"||t===null},mask:{...ke.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:t=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Ye,setup(t,{slots:O,emit:Z}){const f=We(),{$q:g}=f.proxy,P=Xe(t,g),{tabindex:b,headerClass:H,getLocale:G,getCurrentDate:r}=Ee(t,g),_=Je(t),M=ul(_);let A,I;const se=B(null),T=c(()=>Se()),F=c(()=>G()),re=c(()=>xe()),K=W(t.modelValue,T.value,F.value,t.calendar,re.value),i=B(yl(K)),u=B(K),v=B(K.hour===null||K.hour<12),pe=c(()=>`q-time q-time--${t.landscape===!0?"landscape":"portrait"}`+(P.value===!0?" q-time--dark q-dark":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-time--readonly":"")+(t.bordered===!0?" q-time--bordered":"")+(t.square===!0?" q-time--square no-border-radius":"")+(t.flat===!0?" q-time--flat no-shadow":"")),R=c(()=>{const e=u.value;return{hour:e.hour===null?"--":h.value===!0?C(e.hour):String(v.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":C(e.minute),second:e.second===null?"--":C(e.second)}}),h=c(()=>t.format24h!==null?t.format24h:g.lang.date.format24h),Ce=c(()=>{const e=i.value==="hour",l=e===!0?12:60,n=u.value[i.value];let d=`rotate(${Math.round(n*(360/l))-180}deg) translateX(-50%)`;return e===!0&&h.value===!0&&u.value.hour>=12&&(d+=" scale(.7)"),{transform:d}}),de=c(()=>u.value.hour!==null),we=c(()=>de.value===!0&&u.value.minute!==null),w=c(()=>t.hourOptions!==void 0?e=>t.hourOptions.includes(e):t.options!==void 0?e=>t.options(e,null,null):null),N=c(()=>t.minuteOptions!==void 0?e=>t.minuteOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,e,null):null),$=c(()=>t.secondOptions!==void 0?e=>t.secondOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,u.value.minute,e):null),y=c(()=>{if(w.value===null)return null;const e=j(0,11,w.value),l=j(12,11,w.value);return{am:e,pm:l,values:e.values.concat(l.values)}}),V=c(()=>N.value!==null?j(0,59,N.value):null),D=c(()=>$.value!==null?j(0,59,$.value):null),Q=c(()=>{switch(i.value){case"hour":return y.value;case"minute":return V.value;case"second":return D.value}}),Ve=c(()=>{let e,l,n=0,o=1;const d=Q.value!==null?Q.value.values:void 0;i.value==="hour"?h.value===!0?(e=0,l=23):(e=0,l=11,v.value===!1&&(n=12)):(e=0,l=55,o=5);const k=[];for(let a=e,m=e;a<=l;a+=o,m++){const p=a+n,Qe=d?.includes(p)===!1,je=i.value==="hour"&&a===0?h.value===!0?"00":"12":a;k.push({val:p,index:m,disable:Qe,label:je})}return k}),De=c(()=>[[Ze,Be,void 0,{stop:!0,prevent:!0,mouse:!0}]]);ye(()=>t.modelValue,e=>{const l=W(e,T.value,F.value,t.calendar,re.value);(l.dateHash!==u.value.dateHash||l.timeHash!==u.value.timeHash)&&(u.value=l,l.hour===null?i.value="hour":v.value=l.hour<12)}),ye([T,F],()=>{Ge(()=>{ae()})});function ce(){const e={...r(),...gl()};ae(e),Object.assign(u.value,e),i.value="hour"}function j(e,l,n){const o=Array.apply(null,{length:l+1}).map((d,k)=>{const a=k+e;return{index:a,val:n(a)===!0}}).filter(d=>d.val===!0).map(d=>d.index);return{min:o[0],max:o[o.length-1],values:o,threshold:l+1}}function ve(e,l,n){const o=Math.abs(e-l);return Math.min(o,n-o)}function ee(e,{min:l,max:n,values:o,threshold:d}){if(e===l)return l;if(e<l||e>n)return ve(e,l,d)<=ve(e,n,d)?l:n;const k=o.findIndex(p=>e<=p),a=o[k-1],m=o[k];return e-a<=m-e?a:m}function Se(){return t.calendar!=="persian"&&t.mask!==null?t.mask:`HH:mm${t.withSeconds===!0?":ss":""}`}function xe(){if(typeof t.defaultDate!="string"){const e=r(!0);return e.dateHash=Re(e),e}return W(t.defaultDate,"YYYY/MM/DD",void 0,t.calendar)}function le(){return nl(f)===!0||Q.value!==null&&(Q.value.values.length===0||i.value==="hour"&&h.value!==!0&&y.value[v.value===!0?"am":"pm"].values.length===0)}function te(){const e=se.value,{top:l,left:n,width:o}=e.getBoundingClientRect(),d=o/2;return{top:l+d,left:n+d,dist:d*.7}}function Be(e){if(le()!==!0){if(e.isFirst===!0){A=te(),I=L(e.evt,A);return}I=L(e.evt,A,I),e.isFinal===!0&&(A=!1,I=null,me())}}function me(){i.value==="hour"?i.value="minute":t.withSeconds&&i.value==="minute"&&(i.value="second")}function L(e,l,n){const o=el(e),d=Math.abs(o.top-l.top),k=Math.sqrt(Math.pow(Math.abs(o.top-l.top),2)+Math.pow(Math.abs(o.left-l.left),2));let a,m=Math.asin(d/k)*(180/Math.PI);if(o.top<l.top?m=l.left<o.left?90-m:270+m:m=l.left<o.left?m+90:270-m,i.value==="hour"){if(a=m/30,y.value!==null){const p=h.value!==!0?v.value===!0:y.value.am.values.length!==0&&y.value.pm.values.length!==0?k>=l.dist:y.value.am.values.length!==0;a=ee(a+(p===!0?0:12),y.value[p===!0?"am":"pm"])}else a=Math.round(a),h.value===!0?k<l.dist?a<12&&(a+=12):a===12&&(a=0):v.value===!0&&a===12?a=0:v.value===!1&&a!==12&&(a+=12);h.value===!0&&(v.value=a<12)}else a=Math.round(m/6)%60,i.value==="minute"&&V.value!==null?a=ee(a,V.value):i.value==="second"&&D.value!==null&&(a=ee(a,D.value));return n!==a&&Ke[i.value](a),a}const ue={hour(){i.value="hour"},minute(){i.value="minute"},second(){i.value="second"}};function Oe(e){e.keyCode===13&&fe()}function Pe(e){e.keyCode===13&&he()}function He(e){le()!==!0&&(g.platform.is.desktop!==!0&&L(e,te()),me())}function Ae(e){le()!==!0&&L(e,te())}function Ie(e){if(e.keyCode===13)i.value="hour";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(y.value!==null){const n=h.value===!0?y.value.values:y.value[v.value===!0?"am":"pm"].values;if(n.length===0)return;if(u.value.hour===null)Y(n[0]);else{const o=(n.length+n.indexOf(u.value.hour)+l)%n.length;Y(n[o])}}else{const n=h.value===!0?24:12,o=h.value!==!0&&v.value===!1?12:0,d=u.value.hour===null?-l:u.value.hour;Y(o+(24+d+l)%n)}}}function Te(e){if(e.keyCode===13)i.value="minute";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(V.value!==null){const n=V.value.values;if(n.length===0)return;if(u.value.minute===null)z(n[0]);else{const o=(n.length+n.indexOf(u.value.minute)+l)%n.length;z(n[o])}}else{const n=u.value.minute===null?-l:u.value.minute;z((60+n+l)%60)}}}function Fe(e){if(e.keyCode===13)i.value="second";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(D.value!==null){const n=D.value.values;if(n.length===0)return;if(u.value.seconds===null)U(n[0]);else{const o=(n.length+n.indexOf(u.value.second)+l)%n.length;U(n[o])}}else{const n=u.value.second===null?-l:u.value.second;U((60+n+l)%60)}}}function Y(e){u.value.hour!==e&&(u.value.hour=e,S())}function z(e){u.value.minute!==e&&(u.value.minute=e,S())}function U(e){u.value.second!==e&&(u.value.second=e,S())}const Ke={hour:Y,minute:z,second:U};function fe(){v.value===!1&&(v.value=!0,u.value.hour!==null&&(u.value.hour-=12,S()))}function he(){v.value===!0&&(v.value=!1,u.value.hour!==null&&(u.value.hour+=12,S()))}function ne(e){const l=t.modelValue;i.value!==e&&l!==void 0&&l!==null&&l!==""&&typeof l!="string"&&(i.value=e)}function S(){if(w.value!==null&&w.value(u.value.hour)!==!0){u.value=W(),ne("hour");return}if(N.value!==null&&N.value(u.value.minute)!==!0){u.value.minute=null,u.value.second=null,ne("minute");return}if(t.withSeconds===!0&&$.value!==null&&$.value(u.value.second)!==!0){u.value.second=null,ne("second");return}u.value.hour===null||u.value.minute===null||t.withSeconds===!0&&u.value.second===null||ae()}function ae(e){const l=Object.assign({...u.value},e),n=t.calendar==="persian"?C(l.hour)+":"+C(l.minute)+(t.withSeconds===!0?":"+C(l.second):""):ll(new Date(l.year,l.month===null?null:l.month-1,l.day,l.hour,l.minute,l.second,l.millisecond),T.value,F.value,l.year,l.timezoneOffset);l.changed=n!==t.modelValue,Z("update:modelValue",n,l)}function Ne(){const e=[s("div",{class:"q-time__link "+(i.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:b.value,onClick:ue.hour,onKeyup:Ie},R.value.hour),s("div",":"),s("div",de.value===!0?{class:"q-time__link "+(i.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:b.value,onKeyup:Te,onClick:ue.minute}:{class:"q-time__link"},R.value.minute)];t.withSeconds===!0&&e.push(s("div",":"),s("div",we.value===!0?{class:"q-time__link "+(i.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:b.value,onKeyup:Fe,onClick:ue.second}:{class:"q-time__link"},R.value.second));const l=[s("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return h.value===!1&&l.push(s("div",{class:"q-time__header-ampm column items-between no-wrap"},[s("div",{class:"q-time__link "+(v.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:b.value,onClick:fe,onKeyup:Oe},"AM"),s("div",{class:"q-time__link "+(v.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:b.value,onClick:he,onKeyup:Pe},"PM")])),s("div",{class:"q-time__header flex flex-center no-wrap "+H.value},l)}function $e(){const e=u.value[i.value];return s("div",{class:"q-time__content col relative-position"},[s(al,{name:"q-transition--scale"},()=>s("div",{key:"clock"+i.value,class:"q-time__container-parent absolute-full"},[s("div",{ref:se,class:"q-time__container-child fit overflow-hidden"},[Me(s("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:He,onMousedown:Ae},[s("div",{class:"q-time__clock-circle fit"},[s("div",{class:"q-time__clock-pointer"+(u.value[i.value]===null?" hidden":t.color!==void 0?` text-${t.color}`:""),style:Ce.value}),Ve.value.map(l=>s("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${l.index}`+(l.val===e?" q-time__clock-position--active "+H.value:l.disable===!0?" q-time__clock-position--disable":"")},[s("span",l.label)]))])]),De.value)])])),t.nowBtn===!0?s(ie,{class:"q-time__now-button absolute",icon:g.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:t.color,textColor:t.textColor,tabindex:b.value,onClick:ce}):null])}return f.proxy.setNow=ce,()=>{const e=[$e()],l=tl(O.default);return l!==void 0&&e.push(s("div",{class:"q-time__actions"},l)),t.name!==void 0&&t.disable!==!0&&M(e,"push"),s("div",{class:pe.value,tabindex:-1},[Ne(),s("div",{class:"q-time__main col overflow-auto"},e)])}}}),_l={class:"row items-center justify-end"},ql={class:"text-negative"},Ml={class:"self-center full-width no-outline",tabindex:"0"},Dl=ol({__name:"BaseTimePicker",props:ge({label:{},dense:{type:Boolean,default:!0},disable:{type:Boolean,default:!1},required:{type:Boolean,default:!1},color:{},editMode:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:ge(["on-update"],["update:modelValue"]),setup(t,{emit:O}){const Z=O,f=il(t,"modelValue"),g=B(null),{t:P}=sl(),b=()=>{f.value=""},H=()=>{g.value&&g.value.hide(),console.log("onClosePicker")},G=r=>{Z("on-update",r)};return(r,_)=>r.editMode?(E(),X(kl,{key:0,modelValue:f.value,"onUpdate:modelValue":_[2]||(_[2]=M=>f.value=M),required:r.required,label:r.label,disable:r.disable,outlined:"",dense:"",mask:"time",rules:["time"]},rl({append:q(()=>[J(hl,{icon:x(qe),flat:"",dense:"",class:"cursor-pointer"},{default:q(()=>[r.editMode?(E(),X(cl,{key:0,ref_key:"timeProxy",ref:g,"transition-show":"scale","transition-hide":"scale",onHide:H},{default:q(()=>[J(bl,{modelValue:f.value,"onUpdate:modelValue":[_[0]||(_[0]=M=>f.value=M),_[1]||(_[1]=M=>G(M))]},{default:q(()=>[oe("div",_l,[Me(J(ie,{label:x(P)("base.close"),color:"primary",flat:""},null,8,["label"]),[[fl]])])]),_:1},8,["modelValue"])]),_:1},512)):_e("",!0)]),_:1},8,["icon"])]),after:q(()=>[f.value&&r.editMode?(E(),X(ie,{key:0,flat:"",round:"",icon:x(dl),onClick:b},null,8,["icon"])):_e("",!0)]),_:2},[r.required&&!f.value&&r.editMode&&!r.disable?{name:"hint",fn:q(()=>[oe("span",ql,be(x(P)("error.validateRequireChoose")),1)]),key:"0"}:void 0]),1032,["modelValue","required","label","disable"])):(E(),X(vl,{key:1,outlined:r.editMode,borderless:!r.editMode,"bottom-slots":"",label:r.label,"stack-label":"",dense:r.dense,disable:r.disable},{prepend:q(()=>[J(ml,{name:x(qe),color:r.color},null,8,["name","color"])]),control:q(()=>[oe("div",Ml,be(f.value),1)]),_:1},8,["outlined","borderless","label","dense","disable"]))}});export{Dl as _};
