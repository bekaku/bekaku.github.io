import{l as H,a as D,c as B,e3 as ee,m as r,n as i,a5 as te,w as a,t as F,a0 as G,u as x,b8 as ae,a3 as v,at as se,x as o,au as E,av as T,L as y,aw as b,J as l,dC as ie,M as L,ca as oe,$ as N,dE as le,dG as z,ai as S,v as ne,dS as re,r as f,ew as ue,y as me,bs as ce,o as de,U as pe,bu as fe,bw as he,R as ge,cW as ve,aB as ye,bk as be,bg as A,a_ as $,ex as _,bL as ke}from"./index-CLKqN-vN.js";import{C as Ce}from"./ClosePopup-BlTOv8y4.js";import{_ as Ie,u as Le}from"./index--5zVtmIq.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B as Se}from"./BaseButton-B0k9Tcp5.js";import{B as we}from"./BaseCard-IBlaP6p_.js";import{B as Te}from"./BaseDropdownMenu-COUK1I3G.js";import{_ as Be}from"./BaseInput.vue_vue_type_script_setup_true_lang-BTxbop2D.js";import{_ as O}from"./BaseResult.vue_vue_type_script_setup_true_lang-CD0kWdHq.js";import{_ as P}from"./BaseScrollArea.vue_vue_type_script_setup_true_lang-CE6lKAg0.js";import{B as Me}from"./BaseTabs-B1Jye3bg.js";import"./BaseVirtualScrollerDynamic.vue_vue_type_script_setup_true_lang-D8hPLR55.js";import"./BaseAvatar-DnAxF3hq.js";import"./FileManagerService-gOE363Ni.js";import"./useAxios-q9_gPrcg.js";import"./BaseFilePicker-CW0iG6HG.js";import"./BaseFilesPreviewItemAlt.vue_vue_type_script_setup_true_lang-BArZm8u4.js";import"./BaseFilesPreviewItem.vue_vue_type_script_setup_true_lang-D-nWsgb5.js";import"./BaseTooltip.vue_vue_type_script_setup_true_lang-BJUeJRon.js";import"./ContentItem-5etIEk2b.js";import"./OpenGraphItemAlt.vue_vue_type_script_setup_true_lang-CPnlJtNb.js";import"./BaseRippleItem.vue_vue_type_script_setup_true_lang-zKn3a2oj.js";import"./BaseInfiniteScroll.vue_vue_type_script_setup_true_lang-COLheYM8.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-DJfgxdwQ.js";import"./useAppMeta-lJIxcsI_.js";import"./use-meta-xuknqjA3.js";import"./BaseSpinner.vue_vue_type_script_setup_true_lang-DspQfui_.js";import"./SkeletonItem.vue_vue_type_script_setup_true_lang-CRrNvfDD.js";import"./BaseLabelValueItem.vue_vue_type_script_setup_true_lang-D2J-bUzp.js";const Ee=["innerHTML"],Ae=H({__name:"BaseContentHtml",props:{content:{},isEscapeHtml:{type:Boolean,default:!1},highLightText:{}},emits:["on-press"],setup(c,{emit:k}){const{inputSanitizeHtml:u}=D(),d=k,h=t=>{d("on-press",t)},g=B(()=>{if(!c.content)return"";const t=c.isEscapeHtml?u(ee(c.content)):u(c.content);return c.highLightText?t.replaceAll(c.highLightText,`<span class='text-weight-bold text-blue'>${c.highLightText}</span>`):t});return(t,m)=>(i(),r(te,null,{default:a(()=>[F("div",G(t.$attrs,{onClick:m[0]||(m[0]=C=>h(C)),innerHTML:g.value}),null,16,Ee)]),_:1}))}}),$e={class:"row"},_e=H({__name:"ChatHistoryItem",props:{item:{},avatarSize:{},isActive:{type:Boolean,default:!1},dense:{type:Boolean,default:!1},closePopup:{type:Boolean},showSettingIcon:{type:Boolean,default:!0},clickable:{type:Boolean,default:!0}},emits:["on-item-click"],setup(c,{emit:k}){const u=k,{appFormatDateAuto:d}=D(),{t:h}=x(),g=()=>{u("on-item-click",c.item)};return(t,m)=>t.item?ae((i(),r(se,G({key:0},t.$attrs,{dense:t.dense,clickable:t.clickable,onClick:g,class:{"active-chat":t.isActive}}),{default:a(()=>[o(E,{avatar:""},{default:a(()=>[o(Ie,{item:t.item},null,8,["item"])]),_:1}),o(E,null,{default:a(()=>[o(T,{lines:"1"},{default:a(()=>[t.item.favorite&&t.showSettingIcon?(i(),r(b,{key:0,color:"amber-8",size:"11px",class:"q-mb-xs",name:l(ie)},null,8,["name"])):v("",!0),y(" "+L(`${t.item.chatType=="GROUP"?"("+l(oe)(t.item.totalMembers)+") ":""}${t.item.groupName?t.item.groupName:l(h)("chats.groupUntitledName")}`),1)]),_:1}),o(T,{caption:"",lines:"1"},{default:a(()=>[F("div",$e,[t.item.muteNotify&&t.showSettingIcon?(i(),r(b,{key:0,size:"15px",class:"text-muted",name:l(le)},null,8,["name"])):v("",!0),t.item.latestMessageType!="LOCATION"&&t.item.latestMessage?(i(),r(Ae,{key:1,content:t.item.latestMessage,"is-escape-html":""},null,8,["content"])):l(z)(t.item.latestMessageType)!=""?(i(),N(S,{key:2},[y(L(l(h)(l(z)(t.item.latestMessageType))),1)],64)):(i(),N(S,{key:3},[y(" Â  ")],64))])]),_:1})]),_:1}),o(E,{side:""},{default:a(()=>[ne(t.$slots,"side",{},()=>[t.item.latestUpdate?(i(),r(T,{key:0,caption:"",lines:"1"},{default:a(()=>[y(L(l(d)(t.item.latestUpdate)),1)]),_:1})):v("",!0),!t.isActive&&t.item.totalNewMessage>0?(i(),r(T,{key:1,caption:""},{default:a(()=>[o(re,{color:"negative"},{default:a(()=>[y(L(t.item.totalNewMessage>=100?"99+":t.item.totalNewMessage),1)]),_:1})]),_:1})):v("",!0)],!0)]),_:3})]),_:3},16,["dense","clickable","class"])),[[Ce]]):v("",!0)}}),U=Ne(_e,[["__scopeId","data-v-04a4557d"]]),ut=H({__name:"ChatLeft",props:{groupItem:{},height:{},showClose:{type:Boolean,default:!1},autoDetect:{type:Boolean,default:!0}},emits:["on-item-click","on-close"],setup(c,{emit:k}){const{t:u}=x(),d=Le(),h=k,g=f("ALL"),t=f([{label:u("chats.all"),value:"ALL"},{label:u("chats.groups"),value:"GROUP"},{label:u("chats.favorite"),value:"FAVORITE"}]),m=f([...ue.dataList]),C=f();f(!1),f("PERSONAL");const W=f([{label:u("chats.addNewprivateChat"),icon:me,value:"PERSONAL"},{label:u("chats.groupChatCreate"),icon:ce,value:"GROUP"}]);de(async()=>{c.autoDetect&&J()});const I=B(()=>{const e=C.value?.toString().trim();return e?m.value.filter(s=>s.groupName&&s.groupName.toLowerCase().includes(e.toLowerCase())):m.value}),q=B(()=>I.value.filter(e=>e.chatType=="GROUP")),R=B(()=>I.value.filter(e=>e.favorite)),J=()=>{if(m.value&&m.value.length>0){const e=m.value[0];e&&w(e)}},X=e=>{console.log("onMenuClick",e)},w=e=>{h("on-item-click",e)},Y=e=>{console.log("onUpdatesearch",e)},V=e=>m.value.findIndex(s=>s.id==e),M=e=>m.value[e],j=async()=>{const e=await ke(m.value,"pin","desc");m.value=e},K=e=>{e!=null&&e>=0&&M(e)&&m.value.splice(e,1)},Q=async(e,s=!0)=>{if(e){const n=V(e);if(n>=0){const p=M(n);p&&p.id&&(p.totalNewMessage=0)}}},Z=()=>{if(!d?.chatId||!d?.chatSettingType){d.clearSetting();return}const e=V(d.chatId);if(e>=0){const s=M(e);if(s)switch(d.chatSettingType){case"NOTIFICATION":s.muteNotify=!s.muteNotify;break;case"PIN":s.pin=!s.pin,j();break;case"FAVORITE":s.favorite=!s.favorite;break;case"LEAVE":K(e);break;case"CLEAR_NEW_MESSAGE_NUMBER":s.totalNewMessage>0&&s.id&&Q(s.id,!0);break;case"CLEAR_NEW_MESSAGE_NUMBER_ONLY":s.id&&Q(s.id,!1);break}}d.clearSetting()};return pe(d,e=>{e.toggleChatSetting&&Z()}),(e,s)=>(i(),r(we,{flat:"",bordered:!1},{default:a(()=>[o(fe,null,{default:a(()=>[o(he,{class:"text-weight-bold"},{default:a(()=>[y(L(l(u)("chats.chats")),1)]),_:1}),e.showClose?(i(),r(Se,{key:0,flat:"",round:"",icon:l(ge),onClick:s[0]||(s[0]=n=>e.$emit("on-close"))},null,8,["icon"])):v("",!0),o(Te,{items:W.value,tooltip:l(u)("chats.addNewChat"),icon:l(ve),onOnClick:X},null,8,["items","tooltip","icon"])]),_:1}),o(ye,null,{default:a(()=>[o(Be,{modelValue:C.value,"onUpdate:modelValue":[s[1]||(s[1]=n=>C.value=n),Y],label:l(u)("base.search"),debounce:250},{prepend:a(()=>[o(b,{name:l(be)},null,8,["name"])]),_:1},8,["modelValue","label"])]),_:1}),o(Me,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=n=>g.value=n),items:t.value,"use-tab-panels":"","keep-alive":"",animated:!1,class:"q-ml-xs"},{ALL:a(()=>[I.value.length>0?(i(),r(A,{key:0},{default:a(()=>[o(P,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,$(I.value,(n,p)=>(i(),r(U,{key:`all-${n.id}-${p}`,item:n,"is-active":e.groupItem?.id==n.id,onOnItemClick:w},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),r(O,{key:1,status:"empty",description:l(u)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[o(b,{name:l(_),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),GROUP:a(()=>[I.value.length>0?(i(),r(A,{key:0},{default:a(()=>[o(P,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,$(q.value,(n,p)=>(i(),r(U,{key:`group-${n.id}-${p}`,item:n,"is-active":e.groupItem?.id==n.id,onOnItemClick:w},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),r(O,{key:1,status:"empty",description:l(u)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[o(b,{name:l(_),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),FAVORITE:a(()=>[R.value.length>0?(i(),r(A,{key:0},{default:a(()=>[o(P,{height:"61vh"},{default:a(()=>[(i(!0),N(S,null,$(R.value,(n,p)=>(i(),r(U,{key:`fav-${n.id}-${p}`,item:n,"is-active":e.groupItem?.id==n.id,onOnItemClick:w},null,8,["item","is-active"]))),128))]),_:1})]),_:1})):(i(),r(O,{key:1,status:"empty",description:l(u)("chats.chatHistoryEmpty"),"show-icon":!1},{extra:a(()=>[o(b,{name:l(_),size:"70px",class:"text-muted"},null,8,["name"])]),_:1},8,["description"]))]),_:1},8,["modelValue","items"])]),_:1}))}});export{ut as default};
