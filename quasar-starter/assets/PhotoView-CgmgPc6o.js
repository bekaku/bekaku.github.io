import{d as X,bG as q,k as f,bn as G,j as K,u as W,b5 as Y,C as z,b0 as J,c as g,o as d,w as i,e,a6 as _,a as ee,d7 as ae,M as k,Y as V,T as s,d8 as te,W as p,X as w,S as m,cn as le,d9 as oe,Z as se,cu as ne,da as ie,c2 as ue,db as re,bu as ce,aV as de,bj as $,a1 as L,a2 as b,a8 as S,dc as fe,dd as me,z as he,cA as ve,c1 as ge}from"./index-BGI1DWlv.js";import{C as T}from"./ClosePopup-C_ezeZOA.js";import{F as we,j as be,k as ye}from"./FileManagerService-BpyyplC3.js";import{B as ke}from"./BaseAvatar-NDUJ6q_g.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAxios-DLselm5l.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./BaseImage-BFLMrB48.js";const Ce={key:2,class:"q-ml-xs text-caption"},xe={class:"row items-center"},Be=X({__name:"PhotoView",props:{showDialog:{type:Boolean,default:!1},showDeleteImage:{type:Boolean,default:!1},maximized:{type:Boolean,default:!0},fetch:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},user:{type:Object,default:()=>null},files:{type:Array,default:()=>[]},images:{type:Array,default:()=>[]},selectedIndex:{type:Number,default:0}},emits:["on-close","update:showDialog","on-before-hide","on:delete"],setup(l,{emit:N}){const u=l,{screen:R}=q(),{fethCdnData:j}=we(),h=f(),C=G(),y=N,{t:v}=K(),{appConfirm:F}=W(),a=f(0),c=f([]),x=f(!1),B=f(!1),D=f(!0);Y(async()=>{a.value=u.selectedIndex,await Z(),D.value=!1,document.addEventListener("keydown",M)});const A=z({get:()=>u.showDialog,set:t=>y("update:showDialog",t)}),M=t=>{t.key==="ArrowLeft"?(x.value=!0,B.value=!1,a.value>0&&a.value--):t.key==="ArrowRight"&&(x.value=!1,B.value=!0,a.value<P.value-1&&a.value++)},I=()=>{A.value=!1,y("on-close")},P=z(()=>u.files&&u.files.length?u.files.length:u.images&&u.images.length?u.images.length:0),Z=async()=>{const t=u.files,o=u.images;if(t&&t.length>0)for(const n of t)if(u.fetch){const r=await Q(n.filePath);r&&c.value.push(r)}else c.value.push(n.filePath);else if(o&&o.length>0)for(const n of o)if(u.fetch){const r=await Q(n.image);r&&c.value.push(r)}else c.value.push(n.image);return new Promise(n=>{n(!0)})},Q=async t=>{const o=await j(t);return o?new Promise(n=>{n(o)}):new Promise(n=>{n(null)})},O=async()=>{if(c.value.length>0){const t=c.value[a.value];t&&be(t,ye())}},E=async()=>{await F(v("app.monogram"),v("base.deletePhotoConfirm"))&&y("on:delete",a.value)},H=()=>{h.value&&h.value.zoomIn()},U=()=>{h.value&&h.value.zoomOut()};return(t,o)=>{const n=J("v-zoomer-gallery");return d(),g(ge,{"model-value":A.value,onHide:I,onBeforeHide:o[3]||(o[3]=r=>t.$emit("on-before-hide")),maximized:l.maximized,"full-width":"","full-height":""},{default:i(()=>[e(_,{class:"text-white",dark:""},{default:i(()=>[e(ae,null,{default:i(()=>[l.user&&l.user.avatar?.thumbnail?(d(),g(ke,{key:0,src:l.user.avatar.thumbnail,size:"32px"},null,8,["src"])):k("",!0),s(R).gt.xs?(d(),g(te,{key:1},{default:i(()=>[p(w(`${s(v)("base.photo")} ${a.value+1}/${l.files.length>0?l.files.length:l.images.length>0?l.images.length:0}`),1)]),_:1})):(d(),V("span",Ce,w(`${a.value+1}/${l.files.length>0?l.files.length:l.images.length>0?l.images.length:0}`),1)),e(m,{dense:"",flat:"",round:"",icon:s(le),onClick:H},null,8,["icon"]),e(m,{dense:"",flat:"",round:"",icon:s(oe),onClick:U},null,8,["icon"]),l.showArrow?(d(),V(se,{key:3},[e(m,{dense:"",flat:"",round:"",icon:s(ne),disable:a.value==0,onClick:o[0]||(o[0]=r=>a.value=a.value-1)},null,8,["icon","disable"]),e(m,{dense:"",flat:"",round:"",icon:s(ie),disable:a.value==P.value-1,onClick:o[1]||(o[1]=r=>a.value=a.value+1)},null,8,["icon","disable"])],64)):k("",!0),e(ue),e(m,{flat:"",round:"",icon:s(re)},{default:i(()=>[e(ce,null,{default:i(()=>[e(de,{style:{"min-width":"100px"}},{default:i(()=>[$((d(),g(L,{clickable:"",onClick:O},{default:i(()=>[e(b,{avatar:""},{default:i(()=>[e(S,{name:s(fe)},null,8,["name"])]),_:1}),e(b,null,{default:i(()=>[p(w(s(v)("base.download")),1)]),_:1})]),_:1})),[[T]]),l.showDeleteImage&&s(C)&&s(C).auth?$((d(),g(L,{key:0,clickable:"",onClick:E},{default:i(()=>[e(b,{avatar:""},{default:i(()=>[e(S,{name:s(me)},null,8,["name"])]),_:1}),e(b,null,{default:i(()=>[p(w(s(v)("base.delete")),1)]),_:1})]),_:1})),[[T]]):k("",!0)]),_:1})]),_:1})]),_:1},8,["icon"]),e(m,{flat:"",round:"",icon:s(he),onClick:I},null,8,["icon"])]),_:1}),ee("div",xe,[e(n,{style:{width:"100%",height:"90vh","background-color":"black",cursor:"pointer"},ref_key:"vZoomerRef",ref:h,list:c.value,modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=r=>a.value=r)},null,8,["list","modelValue"]),e(ve,{showing:D.value,"label-class":"text-white"},null,8,["showing"])])]),_:1})]),_:1},8,["model-value","maximized"])}}}),Le=pe(Be,[["__scopeId","data-v-c348c940"]]);export{Le as default};
