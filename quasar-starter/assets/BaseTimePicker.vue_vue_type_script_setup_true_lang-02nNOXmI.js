import{aR as ze,c8 as Le,c9 as ke,ca as Xe,b$ as Ye,bR as Ue,c0 as Ee,cb as We,cc as Ge,k as B,C as c,cd as U,ce as p,cf as Je,E as be,bX as Re,cg as Ze,ch as el,ci as ll,bT as tl,aS as s,cj as ul,ck as nl,cl as al,bj as Ce,S as ie,d as ol,ai as ye,aj as il,j as sl,c as E,o as W,bA as rl,w as q,a as oe,X as ge,T as x,M as _e,bC as dl,e as G,bB as cl,cm as qe,bz as vl,a8 as ml}from"./index-BGI1DWlv.js";import{C as fl}from"./ClosePopup-C_ezeZOA.js";import{B as hl}from"./BaseButton-DKzenQbr.js";import{_ as kl}from"./BaseInput.vue_vue_type_script_setup_true_lang-BZpyMKDQ.js";function bl(t,O){return t.hour!==null&&t.minute===null?"minute":"hour"}function yl(){const t=new Date;return{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()}}const gl=ze({name:"QTime",props:{...Ye,...Xe,...ke,modelValue:{required:!0,validator:t=>typeof t=="string"||t===null},mask:{...ke.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:t=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Le,setup(t,{slots:O,emit:J}){const f=Ue(),{$q:y}=f.proxy,P=Ee(t,y),{tabindex:g,headerClass:H,getLocale:R,getCurrentDate:r}=We(t,y),_=Ge(t),C=ul(_);let A,I;const se=B(null),T=c(()=>Se()),F=c(()=>R()),re=c(()=>xe()),K=U(t.modelValue,T.value,F.value,t.calendar,re.value),i=B(bl(K)),u=B(K),v=B(K.hour===null||K.hour<12),Me=c(()=>`q-time q-time--${t.landscape===!0?"landscape":"portrait"}`+(P.value===!0?" q-time--dark q-dark":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-time--readonly":"")+(t.bordered===!0?" q-time--bordered":"")+(t.square===!0?" q-time--square no-border-radius":"")+(t.flat===!0?" q-time--flat no-shadow":"")),Z=c(()=>{const e=u.value;return{hour:e.hour===null?"--":h.value===!0?p(e.hour):String(v.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":p(e.minute),second:e.second===null?"--":p(e.second)}}),h=c(()=>t.format24h!==null?t.format24h:y.lang.date.format24h),pe=c(()=>{const e=i.value==="hour",l=e===!0?12:60,n=u.value[i.value];let d=`rotate(${Math.round(n*(360/l))-180}deg) translateX(-50%)`;return e===!0&&h.value===!0&&u.value.hour>=12&&(d+=" scale(.7)"),{transform:d}}),de=c(()=>u.value.hour!==null),we=c(()=>de.value===!0&&u.value.minute!==null),w=c(()=>t.hourOptions!==void 0?e=>t.hourOptions.includes(e):t.options!==void 0?e=>t.options(e,null,null):null),j=c(()=>t.minuteOptions!==void 0?e=>t.minuteOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,e,null):null),$=c(()=>t.secondOptions!==void 0?e=>t.secondOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,u.value.minute,e):null),b=c(()=>{if(w.value===null)return null;const e=Q(0,11,w.value),l=Q(12,11,w.value);return{am:e,pm:l,values:e.values.concat(l.values)}}),V=c(()=>j.value!==null?Q(0,59,j.value):null),D=c(()=>$.value!==null?Q(0,59,$.value):null),N=c(()=>{switch(i.value){case"hour":return b.value;case"minute":return V.value;case"second":return D.value}}),Ve=c(()=>{let e,l,n=0,o=1;const d=N.value!==null?N.value.values:void 0;i.value==="hour"?h.value===!0?(e=0,l=23):(e=0,l=11,v.value===!1&&(n=12)):(e=0,l=55,o=5);const k=[];for(let a=e,m=e;a<=l;a+=o,m++){const M=a+n,Ne=d?.includes(M)===!1,Qe=i.value==="hour"&&a===0?h.value===!0?"00":"12":a;k.push({val:M,index:m,disable:Ne,label:Qe})}return k}),De=c(()=>[[Je,Be,void 0,{stop:!0,prevent:!0,mouse:!0}]]);be(()=>t.modelValue,e=>{const l=U(e,T.value,F.value,t.calendar,re.value);(l.dateHash!==u.value.dateHash||l.timeHash!==u.value.timeHash)&&(u.value=l,l.hour===null?i.value="hour":v.value=l.hour<12)}),be([T,F],()=>{Re(()=>{ae()})});function ce(){const e={...r(),...yl()};ae(e),Object.assign(u.value,e),i.value="hour"}function Q(e,l,n){const o=Array.apply(null,{length:l+1}).map((d,k)=>{const a=k+e;return{index:a,val:n(a)===!0}}).filter(d=>d.val===!0).map(d=>d.index);return{min:o[0],max:o[o.length-1],values:o,threshold:l+1}}function ve(e,l,n){const o=Math.abs(e-l);return Math.min(o,n-o)}function ee(e,{min:l,max:n,values:o,threshold:d}){if(e===l)return l;if(e<l||e>n)return ve(e,l,d)<=ve(e,n,d)?l:n;const k=o.findIndex(M=>e<=M),a=o[k-1],m=o[k];return e-a<=m-e?a:m}function Se(){return t.calendar!=="persian"&&t.mask!==null?t.mask:`HH:mm${t.withSeconds===!0?":ss":""}`}function xe(){if(typeof t.defaultDate!="string"){const e=r(!0);return e.dateHash=Ze(e),e}return U(t.defaultDate,"YYYY/MM/DD",void 0,t.calendar)}function le(){return nl(f)===!0||N.value!==null&&(N.value.values.length===0||i.value==="hour"&&h.value!==!0&&b.value[v.value===!0?"am":"pm"].values.length===0)}function te(){const e=se.value,{top:l,left:n,width:o}=e.getBoundingClientRect(),d=o/2;return{top:l+d,left:n+d,dist:d*.7}}function Be(e){if(le()!==!0){if(e.isFirst===!0){A=te(),I=z(e.evt,A);return}I=z(e.evt,A,I),e.isFinal===!0&&(A=!1,I=null,me())}}function me(){i.value==="hour"?i.value="minute":t.withSeconds&&i.value==="minute"&&(i.value="second")}function z(e,l,n){const o=el(e),d=Math.abs(o.top-l.top),k=Math.sqrt(Math.pow(Math.abs(o.top-l.top),2)+Math.pow(Math.abs(o.left-l.left),2));let a,m=Math.asin(d/k)*(180/Math.PI);if(o.top<l.top?m=l.left<o.left?90-m:270+m:m=l.left<o.left?m+90:270-m,i.value==="hour"){if(a=m/30,b.value!==null){const M=h.value!==!0?v.value===!0:b.value.am.values.length!==0&&b.value.pm.values.length!==0?k>=l.dist:b.value.am.values.length!==0;a=ee(a+(M===!0?0:12),b.value[M===!0?"am":"pm"])}else a=Math.round(a),h.value===!0?k<l.dist?a<12&&(a+=12):a===12&&(a=0):v.value===!0&&a===12?a=0:v.value===!1&&a!==12&&(a+=12);h.value===!0&&(v.value=a<12)}else a=Math.round(m/6)%60,i.value==="minute"&&V.value!==null?a=ee(a,V.value):i.value==="second"&&D.value!==null&&(a=ee(a,D.value));return n!==a&&Ke[i.value](a),a}const ue={hour(){i.value="hour"},minute(){i.value="minute"},second(){i.value="second"}};function Oe(e){e.keyCode===13&&fe()}function Pe(e){e.keyCode===13&&he()}function He(e){le()!==!0&&(y.platform.is.desktop!==!0&&z(e,te()),me())}function Ae(e){le()!==!0&&z(e,te())}function Ie(e){if(e.keyCode===13)i.value="hour";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(b.value!==null){const n=h.value===!0?b.value.values:b.value[v.value===!0?"am":"pm"].values;if(n.length===0)return;if(u.value.hour===null)L(n[0]);else{const o=(n.length+n.indexOf(u.value.hour)+l)%n.length;L(n[o])}}else{const n=h.value===!0?24:12,o=h.value!==!0&&v.value===!1?12:0,d=u.value.hour===null?-l:u.value.hour;L(o+(24+d+l)%n)}}}function Te(e){if(e.keyCode===13)i.value="minute";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(V.value!==null){const n=V.value.values;if(n.length===0)return;if(u.value.minute===null)X(n[0]);else{const o=(n.length+n.indexOf(u.value.minute)+l)%n.length;X(n[o])}}else{const n=u.value.minute===null?-l:u.value.minute;X((60+n+l)%60)}}}function Fe(e){if(e.keyCode===13)i.value="second";else if([37,39].includes(e.keyCode)){const l=e.keyCode===37?-1:1;if(D.value!==null){const n=D.value.values;if(n.length===0)return;if(u.value.seconds===null)Y(n[0]);else{const o=(n.length+n.indexOf(u.value.second)+l)%n.length;Y(n[o])}}else{const n=u.value.second===null?-l:u.value.second;Y((60+n+l)%60)}}}function L(e){u.value.hour!==e&&(u.value.hour=e,S())}function X(e){u.value.minute!==e&&(u.value.minute=e,S())}function Y(e){u.value.second!==e&&(u.value.second=e,S())}const Ke={hour:L,minute:X,second:Y};function fe(){v.value===!1&&(v.value=!0,u.value.hour!==null&&(u.value.hour-=12,S()))}function he(){v.value===!0&&(v.value=!1,u.value.hour!==null&&(u.value.hour+=12,S()))}function ne(e){const l=t.modelValue;i.value!==e&&l!==void 0&&l!==null&&l!==""&&typeof l!="string"&&(i.value=e)}function S(){if(w.value!==null&&w.value(u.value.hour)!==!0){u.value=U(),ne("hour");return}if(j.value!==null&&j.value(u.value.minute)!==!0){u.value.minute=null,u.value.second=null,ne("minute");return}if(t.withSeconds===!0&&$.value!==null&&$.value(u.value.second)!==!0){u.value.second=null,ne("second");return}u.value.hour===null||u.value.minute===null||t.withSeconds===!0&&u.value.second===null||ae()}function ae(e){const l=Object.assign({...u.value},e),n=t.calendar==="persian"?p(l.hour)+":"+p(l.minute)+(t.withSeconds===!0?":"+p(l.second):""):ll(new Date(l.year,l.month===null?null:l.month-1,l.day,l.hour,l.minute,l.second,l.millisecond),T.value,F.value,l.year,l.timezoneOffset);l.changed=n!==t.modelValue,J("update:modelValue",n,l)}function je(){const e=[s("div",{class:"q-time__link "+(i.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:ue.hour,onKeyup:Ie},Z.value.hour),s("div",":"),s("div",de.value===!0?{class:"q-time__link "+(i.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onKeyup:Te,onClick:ue.minute}:{class:"q-time__link"},Z.value.minute)];t.withSeconds===!0&&e.push(s("div",":"),s("div",we.value===!0?{class:"q-time__link "+(i.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onKeyup:Fe,onClick:ue.second}:{class:"q-time__link"},Z.value.second));const l=[s("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return h.value===!1&&l.push(s("div",{class:"q-time__header-ampm column items-between no-wrap"},[s("div",{class:"q-time__link "+(v.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:fe,onKeyup:Oe},"AM"),s("div",{class:"q-time__link "+(v.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:he,onKeyup:Pe},"PM")])),s("div",{class:"q-time__header flex flex-center no-wrap "+H.value},l)}function $e(){const e=u.value[i.value];return s("div",{class:"q-time__content col relative-position"},[s(al,{name:"q-transition--scale"},()=>s("div",{key:"clock"+i.value,class:"q-time__container-parent absolute-full"},[s("div",{ref:se,class:"q-time__container-child fit overflow-hidden"},[Ce(s("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:He,onMousedown:Ae},[s("div",{class:"q-time__clock-circle fit"},[s("div",{class:"q-time__clock-pointer"+(u.value[i.value]===null?" hidden":t.color!==void 0?` text-${t.color}`:""),style:pe.value}),Ve.value.map(l=>s("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${l.index}`+(l.val===e?" q-time__clock-position--active "+H.value:l.disable===!0?" q-time__clock-position--disable":"")},[s("span",l.label)]))])]),De.value)])])),t.nowBtn===!0?s(ie,{class:"q-time__now-button absolute",icon:y.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:t.color,textColor:t.textColor,tabindex:g.value,onClick:ce}):null])}return f.proxy.setNow=ce,()=>{const e=[$e()],l=tl(O.default);return l!==void 0&&e.push(s("div",{class:"q-time__actions"},l)),t.name!==void 0&&t.disable!==!0&&C(e,"push"),s("div",{class:Me.value,tabindex:-1},[je(),s("div",{class:"q-time__main col overflow-auto"},e)])}}}),_l={class:"row items-center justify-end"},ql={class:"text-negative"},Cl={class:"self-center full-width no-outline",tabindex:"0"},Dl=ol({__name:"BaseTimePicker",props:ye({label:{},dense:{type:Boolean,default:!0},disable:{type:Boolean,default:!1},required:{type:Boolean,default:!1},color:{},editMode:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:ye(["on-update"],["update:modelValue"]),setup(t,{emit:O}){const J=O,f=il(t,"modelValue"),y=B(null),{t:P}=sl(),g=()=>{f.value=""},H=()=>{y.value&&y.value.hide(),console.log("onClosePicker")},R=r=>{J("on-update",r)};return(r,_)=>r.editMode?(W(),E(kl,{key:0,modelValue:f.value,"onUpdate:modelValue":_[2]||(_[2]=C=>f.value=C),required:r.required,label:r.label,disable:r.disable,outlined:"",dense:"",mask:"time",rules:["time"]},rl({append:q(()=>[G(hl,{icon:x(qe),flat:"",dense:"",class:"cursor-pointer"},{default:q(()=>[r.editMode?(W(),E(cl,{key:0,ref_key:"timeProxy",ref:y,"transition-show":"scale","transition-hide":"scale",onHide:H},{default:q(()=>[G(gl,{modelValue:f.value,"onUpdate:modelValue":[_[0]||(_[0]=C=>f.value=C),_[1]||(_[1]=C=>R(C))]},{default:q(()=>[oe("div",_l,[Ce(G(ie,{label:x(P)("base.close"),color:"primary",flat:""},null,8,["label"]),[[fl]])])]),_:1},8,["modelValue"])]),_:1},512)):_e("",!0)]),_:1},8,["icon"])]),after:q(()=>[f.value&&r.editMode?(W(),E(ie,{key:0,flat:"",round:"",icon:x(dl),onClick:g},null,8,["icon"])):_e("",!0)]),_:2},[r.required&&!f.value&&r.editMode&&!r.disable?{name:"hint",fn:q(()=>[oe("span",ql,ge(x(P)("error.validateRequireChoose")),1)]),key:"0"}:void 0]),1032,["modelValue","required","label","disable"])):(W(),E(vl,{key:1,outlined:r.editMode,borderless:!r.editMode,"bottom-slots":"",label:r.label,"stack-label":"",dense:r.dense,disable:r.disable},{prepend:q(()=>[G(ml,{name:x(qe),color:r.color},null,8,["name","color"])]),control:q(()=>[oe("div",Cl,ge(f.value),1)]),_:1},8,["outlined","borderless","label","dense","disable"]))}});export{Dl as _};
